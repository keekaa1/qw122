2025-06-22 17:11:37,788 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 17:11:37,788 [INFO] Запуск player_passport_etl.py
2025-06-22 17:11:37,888 [ERROR] [STDERR] Python
2025-06-22 17:11:37,888 [ERROR] player_passport_etl.py завершился с кодом 9009
2025-06-22 17:11:37,889 [INFO] Запуск player_h2h_etl.py
2025-06-22 17:11:37,957 [ERROR] [STDERR] Python
2025-06-22 17:11:37,957 [ERROR] player_h2h_etl.py завершился с кодом 9009
2025-06-22 17:11:37,957 [INFO] Запуск player_resilience_etl.py
2025-06-22 17:11:38,027 [ERROR] [STDERR] Python
2025-06-22 17:11:38,027 [ERROR] player_resilience_etl.py завершился с кодом 9009
2025-06-22 17:11:38,027 [INFO] Запуск player_style_etl.py
2025-06-22 17:11:38,095 [ERROR] [STDERR] Python
2025-06-22 17:11:38,095 [ERROR] player_style_etl.py завершился с кодом 9009
2025-06-22 17:11:38,095 [INFO] Запуск player_fatigue_etl.py
2025-06-22 17:11:38,165 [ERROR] [STDERR] Python
2025-06-22 17:11:38,165 [ERROR] player_fatigue_etl.py завершился с кодом 9009
2025-06-22 17:11:38,165 [INFO] Запуск player_elo_etl.py
2025-06-22 17:11:38,235 [ERROR] [STDERR] Python
2025-06-22 17:11:38,235 [ERROR] player_elo_etl.py завершился с кодом 9009
2025-06-22 17:11:38,235 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 17:11:38,304 [ERROR] [STDERR] Python
2025-06-22 17:11:38,305 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 9009
2025-06-22 17:11:38,305 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 17:11:38,373 [ERROR] [STDERR] Python
2025-06-22 17:11:38,373 [ERROR] league_reference_etl_ultimate.py завершился с кодом 9009
2025-06-22 17:11:38,373 [INFO] Запуск player_table_stats_etl.py
2025-06-22 17:11:38,440 [ERROR] [STDERR] Python
2025-06-22 17:11:38,440 [ERROR] player_table_stats_etl.py завершился с кодом 9009
2025-06-22 17:11:38,440 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 17:11:38,506 [ERROR] [STDERR] Python
2025-06-22 17:11:38,507 [ERROR] player_sos_windows_etl.py завершился с кодом 9009
2025-06-22 17:11:38,507 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 17:11:38,507 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 17:14:31,205 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 17:14:31,205 [INFO] Запуск player_passport_etl.py
2025-06-22 17:14:31,522 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 17:14:31,522 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 17:14:31,522 [INFO] Запуск player_h2h_etl.py
2025-06-22 17:14:35,630 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 17:14:35,630 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 17:14:35,630 [INFO] Запуск player_resilience_etl.py
2025-06-22 17:15:18,885 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 17:15:18,885 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 17:15:18,885 [INFO] Запуск player_style_etl.py
2025-06-22 17:15:49,851 [INFO] [STDOUT] Топ-3 balanced:  [['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]
 ['Алексей Конобеев' 75.19489981785064]]
Топ-3 aggressive:  [['Николай Ижиков' 81.23529411764706]
 ['Эдуард Головачев' 80.70402298850574]
 ['Артем Чернов' 79.6036036036036]]
Топ-3 chaotic:  [['Алексей Иванов' 77.00704225352112]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 17:15:49,851 [INFO] player_style_etl.py успешно выполнен
2025-06-22 17:15:49,851 [INFO] Запуск player_fatigue_etl.py
2025-06-22 17:15:58,527 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 17:15:58,527 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 17:15:58,527 [INFO] Запуск player_elo_etl.py
2025-06-22 17:16:14,631 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126038 записей (по всем матчам)
2025-06-22 17:16:14,631 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 17:16:14,631 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 17:17:11,677 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 17:17:11,677 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 17:17:11,677 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 17:17:13,409 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 17:17:13,409 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 17:17:13,409 [INFO] Запуск player_table_stats_etl.py
2025-06-22 17:17:17,384 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 17:17:17,385 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 17:17:17,385 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 17:18:46,400 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 17:18:46,400 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 17:18:46,401 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 17:18:46,401 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 17:28:46,401 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 17:28:46,401 [INFO] Запуск player_passport_etl.py
2025-06-22 17:28:52,008 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 17:28:52,009 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 17:28:52,009 [INFO] Запуск player_h2h_etl.py
2025-06-22 17:28:58,136 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 17:28:58,137 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 17:28:58,137 [INFO] Запуск player_resilience_etl.py
2025-06-22 17:30:03,171 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 17:30:03,171 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 17:30:03,171 [INFO] Запуск player_style_etl.py
2025-06-22 17:30:37,126 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]
 ['Алексей Конобеев' 75.14079422382672]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 17:30:37,126 [INFO] player_style_etl.py успешно выполнен
2025-06-22 17:30:37,126 [INFO] Запуск player_fatigue_etl.py
2025-06-22 17:30:47,180 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 17:30:47,180 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 17:30:47,180 [INFO] Запуск player_elo_etl.py
2025-06-22 17:31:04,460 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126012 записей (по всем матчам)
2025-06-22 17:31:04,460 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 17:31:04,460 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 17:32:38,573 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 17:32:38,574 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 17:32:38,574 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 17:32:43,249 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 17:32:43,250 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 17:32:43,250 [INFO] Запуск player_table_stats_etl.py
2025-06-22 17:32:53,842 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-22 17:32:53,842 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-22 17:32:53,842 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 17:34:42,814 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 17:34:42,814 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 17:34:42,814 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 17:34:42,814 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 17:44:42,815 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 17:44:42,815 [INFO] Запуск player_passport_etl.py
2025-06-22 17:44:47,142 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 17:44:47,143 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 17:44:47,143 [INFO] Запуск player_h2h_etl.py
2025-06-22 17:44:58,713 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 17:44:58,713 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 17:44:58,713 [INFO] Запуск player_resilience_etl.py
2025-06-22 17:46:01,719 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 17:46:01,719 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 17:46:01,719 [INFO] Запуск player_style_etl.py
2025-06-22 17:46:36,157 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 17:46:36,157 [INFO] player_style_etl.py успешно выполнен
2025-06-22 17:46:36,157 [INFO] Запуск player_fatigue_etl.py
2025-06-22 17:46:45,958 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 17:46:45,958 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 17:46:45,958 [INFO] Запуск player_elo_etl.py
2025-06-22 17:47:03,796 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126016 записей (по всем матчам)
2025-06-22 17:47:03,796 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 17:47:03,796 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 17:48:38,271 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 17:48:38,271 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 17:48:38,271 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 17:48:41,370 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 17:48:41,370 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 17:48:41,370 [INFO] Запуск player_table_stats_etl.py
2025-06-22 17:48:47,598 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 17:48:47,598 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 17:48:47,598 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 17:50:33,632 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 17:50:33,632 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 17:50:33,632 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 17:50:33,632 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 18:00:33,633 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 18:00:33,633 [INFO] Запуск player_passport_etl.py
2025-06-22 18:00:40,330 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-22 18:00:40,331 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 18:00:40,331 [INFO] Запуск player_h2h_etl.py
2025-06-22 18:00:49,120 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 18:00:49,120 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 18:00:49,120 [INFO] Запуск player_resilience_etl.py
2025-06-22 18:01:57,300 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 18:01:57,300 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 18:01:57,300 [INFO] Запуск player_style_etl.py
2025-06-22 18:02:32,380 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 18:02:32,380 [INFO] player_style_etl.py успешно выполнен
2025-06-22 18:02:32,380 [INFO] Запуск player_fatigue_etl.py
2025-06-22 18:02:42,349 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 18:02:42,349 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 18:02:42,349 [INFO] Запуск player_elo_etl.py
2025-06-22 18:02:58,868 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126022 записей (по всем матчам)
2025-06-22 18:02:58,868 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 18:02:58,868 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 18:04:32,806 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 18:04:32,806 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 18:04:32,806 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 18:04:34,750 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 18:04:34,750 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 18:04:34,751 [INFO] Запуск player_table_stats_etl.py
2025-06-22 18:04:40,200 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 18:04:40,200 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 18:04:40,200 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 18:06:16,845 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 18:06:16,845 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 18:06:16,846 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 18:06:16,846 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 18:16:16,846 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 18:16:16,847 [INFO] Запуск player_passport_etl.py
2025-06-22 18:16:22,888 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 18:16:22,888 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 18:16:22,888 [INFO] Запуск player_h2h_etl.py
2025-06-22 18:16:34,767 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-22 18:16:34,768 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-22 18:16:34,768 [INFO] Запуск player_resilience_etl.py
2025-06-22 18:17:45,890 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-22 18:17:45,890 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-22 18:17:45,890 [INFO] Запуск player_style_etl.py
2025-06-22 18:18:18,930 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]
 ['Алексей Конобеев' 75.14079422382672]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 18:18:18,931 [INFO] player_style_etl.py успешно выполнен
2025-06-22 18:18:18,931 [INFO] Запуск player_fatigue_etl.py
2025-06-22 18:18:28,915 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 18:18:28,915 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 18:18:28,915 [INFO] Запуск player_elo_etl.py
2025-06-22 18:18:45,530 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126026 записей (по всем матчам)
2025-06-22 18:18:45,530 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 18:18:45,531 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 18:20:21,912 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 18:20:21,913 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 18:20:21,913 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 18:20:23,906 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 18:20:23,907 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 18:20:23,907 [INFO] Запуск player_table_stats_etl.py
2025-06-22 18:20:34,006 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 18:20:34,006 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 18:20:34,006 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 18:22:18,999 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 18:22:19,000 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 18:22:19,000 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 18:22:19,000 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 18:32:19,000 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 18:32:19,000 [INFO] Запуск player_passport_etl.py
2025-06-22 18:32:23,358 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 18:32:23,358 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 18:32:23,358 [INFO] Запуск player_h2h_etl.py
2025-06-22 18:32:34,499 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-22 18:32:34,499 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-22 18:32:34,499 [INFO] Запуск player_resilience_etl.py
2025-06-22 18:33:38,127 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 18:33:38,127 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 18:33:38,127 [INFO] Запуск player_style_etl.py
2025-06-22 18:34:13,256 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 18:34:13,256 [INFO] player_style_etl.py успешно выполнен
2025-06-22 18:34:13,257 [INFO] Запуск player_fatigue_etl.py
2025-06-22 18:34:22,959 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 18:34:22,959 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 18:34:22,959 [INFO] Запуск player_elo_etl.py
2025-06-22 18:34:40,153 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126032 записей (по всем матчам)
2025-06-22 18:34:40,153 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 18:34:40,154 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 18:36:18,674 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 18:36:18,675 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 18:36:18,675 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 18:36:26,628 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-22 18:36:26,628 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-22 18:36:26,628 [INFO] Запуск player_table_stats_etl.py
2025-06-22 18:36:31,328 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 18:36:31,328 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 18:36:31,328 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 18:38:12,565 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 18:38:12,566 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 18:38:12,566 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 18:38:12,566 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 18:48:12,566 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 18:48:12,567 [INFO] Запуск player_passport_etl.py
2025-06-22 18:48:13,231 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 18:48:13,231 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 18:48:13,231 [INFO] Запуск player_h2h_etl.py
2025-06-22 18:48:24,695 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-22 18:48:24,695 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-22 18:48:24,695 [INFO] Запуск player_resilience_etl.py
2025-06-22 18:49:33,384 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 18:49:33,385 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 18:49:33,385 [INFO] Запуск player_style_etl.py
2025-06-22 18:50:08,569 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]
 ['Алексей Конобеев' 75.14079422382672]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 18:50:08,569 [INFO] player_style_etl.py успешно выполнен
2025-06-22 18:50:08,569 [INFO] Запуск player_fatigue_etl.py
2025-06-22 18:50:18,464 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 18:50:18,464 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 18:50:18,464 [INFO] Запуск player_elo_etl.py
2025-06-22 18:50:34,727 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126034 записей (по всем матчам)
2025-06-22 18:50:34,727 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 18:50:34,727 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 18:52:04,662 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 18:52:04,662 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 18:52:04,662 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 18:52:06,822 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 18:52:06,822 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 18:52:06,822 [INFO] Запуск player_table_stats_etl.py
2025-06-22 18:52:11,458 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 18:52:11,458 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 18:52:11,458 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 18:53:59,897 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 18:53:59,897 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 18:53:59,897 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 18:53:59,897 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 19:03:59,898 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 19:03:59,898 [INFO] Запуск player_passport_etl.py
2025-06-22 19:04:06,490 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-22 19:04:06,491 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 19:04:06,491 [INFO] Запуск player_h2h_etl.py
2025-06-22 19:04:14,055 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 19:04:14,056 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 19:04:14,056 [INFO] Запуск player_resilience_etl.py
2025-06-22 19:05:20,025 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 19:05:20,026 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 19:05:20,026 [INFO] Запуск player_style_etl.py
2025-06-22 19:05:52,740 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 19:05:52,740 [INFO] player_style_etl.py успешно выполнен
2025-06-22 19:05:52,740 [INFO] Запуск player_fatigue_etl.py
2025-06-22 19:06:01,825 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 19:06:01,826 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 19:06:01,826 [INFO] Запуск player_elo_etl.py
2025-06-22 19:06:18,390 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126042 записей (по всем матчам)
2025-06-22 19:06:18,390 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 19:06:18,391 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 19:07:51,323 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
2025-06-22 19:07:51,323 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-22 19:07:51,323 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-22 19:07:51,323 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 19:07:57,449 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 19:07:57,449 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 19:07:57,449 [INFO] Запуск player_table_stats_etl.py
2025-06-22 19:08:02,055 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 19:08:02,056 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 19:08:02,056 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 19:09:41,392 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 19:09:41,392 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 19:09:41,392 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 19:09:41,393 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 19:19:41,393 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 19:19:41,393 [INFO] Запуск player_passport_etl.py
2025-06-22 19:19:45,515 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 19:19:45,515 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 19:19:45,515 [INFO] Запуск player_h2h_etl.py
2025-06-22 19:19:56,498 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 19:19:56,499 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 19:19:56,499 [INFO] Запуск player_resilience_etl.py
2025-06-22 19:20:52,843 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 19:20:52,843 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 19:20:52,843 [INFO] Запуск player_style_etl.py
2025-06-22 19:21:24,305 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 19:21:24,305 [INFO] player_style_etl.py успешно выполнен
2025-06-22 19:21:24,306 [INFO] Запуск player_fatigue_etl.py
2025-06-22 19:21:32,873 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 19:21:32,873 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 19:21:32,873 [INFO] Запуск player_elo_etl.py
2025-06-22 19:22:03,021 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 19:22:03,021 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-22 19:22:03,022 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 19:22:03,022 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 19:23:37,984 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 19:23:37,984 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 19:23:37,985 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 19:23:41,976 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 19:23:41,976 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 19:23:41,976 [INFO] Запуск player_table_stats_etl.py
2025-06-22 19:23:46,539 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 19:23:46,539 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 19:23:46,540 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 19:25:31,828 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 19:25:31,828 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 19:25:31,828 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 19:25:31,828 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 19:35:31,828 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 19:35:31,829 [INFO] Запуск player_passport_etl.py
2025-06-22 19:35:33,485 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 19:35:33,486 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 19:35:33,486 [INFO] Запуск player_h2h_etl.py
2025-06-22 19:35:40,351 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 19:35:40,351 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 19:35:40,351 [INFO] Запуск player_resilience_etl.py
2025-06-22 19:36:29,149 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 19:36:29,149 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 19:36:29,149 [INFO] Запуск player_style_etl.py
2025-06-22 19:36:59,493 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 19:36:59,494 [INFO] player_style_etl.py успешно выполнен
2025-06-22 19:36:59,494 [INFO] Запуск player_fatigue_etl.py
2025-06-22 19:37:16,575 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 19:37:16,575 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 19:37:16,576 [INFO] Запуск player_elo_etl.py
2025-06-22 19:37:42,123 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126050 записей (по всем матчам)
2025-06-22 19:37:42,123 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 19:37:42,123 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 19:39:14,114 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 19:39:14,114 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 19:39:14,114 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 19:39:21,058 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 19:39:21,058 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 19:39:21,059 [INFO] Запуск player_table_stats_etl.py
2025-06-22 19:39:25,094 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 19:39:25,094 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 19:39:25,094 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 19:41:06,144 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 19:41:06,144 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 19:41:06,144 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 19:41:06,144 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 19:51:06,145 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 19:51:06,145 [INFO] Запуск player_passport_etl.py
2025-06-22 19:51:14,393 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-22 19:51:14,394 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 19:51:14,394 [INFO] Запуск player_h2h_etl.py
2025-06-22 19:51:19,763 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 19:51:19,764 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 19:51:19,764 [INFO] Запуск player_resilience_etl.py
2025-06-22 19:52:06,203 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 19:52:06,203 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 19:52:06,203 [INFO] Запуск player_style_etl.py
2025-06-22 19:52:45,184 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 19:52:45,184 [INFO] player_style_etl.py успешно выполнен
2025-06-22 19:52:45,184 [INFO] Запуск player_fatigue_etl.py
2025-06-22 19:52:57,279 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 19:52:57,279 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 19:52:57,279 [INFO] Запуск player_elo_etl.py
2025-06-22 19:53:31,057 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 19:53:31,057 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-22 19:53:31,058 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 19:53:31,058 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 19:54:54,667 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 19:54:54,667 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 19:54:54,667 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 19:54:56,402 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 19:54:56,403 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 19:54:56,403 [INFO] Запуск player_table_stats_etl.py
2025-06-22 19:55:00,333 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 19:55:00,334 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 19:55:00,334 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 19:56:47,787 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 19:56:47,787 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 19:56:47,787 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 19:56:47,788 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 20:06:47,788 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 20:06:47,788 [INFO] Запуск player_passport_etl.py
2025-06-22 20:06:55,936 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-22 20:06:55,936 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 20:06:55,936 [INFO] Запуск player_h2h_etl.py
2025-06-22 20:07:01,265 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 20:07:01,265 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 20:07:01,266 [INFO] Запуск player_resilience_etl.py
2025-06-22 20:07:51,323 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 20:07:51,323 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 20:07:51,323 [INFO] Запуск player_style_etl.py
2025-06-22 20:08:37,397 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 20:08:37,397 [INFO] player_style_etl.py успешно выполнен
2025-06-22 20:08:37,397 [INFO] Запуск player_fatigue_etl.py
2025-06-22 20:08:55,129 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 20:08:55,130 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 20:08:55,130 [INFO] Запуск player_elo_etl.py
2025-06-22 20:09:21,607 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 20:09:21,607 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 20:09:21,608 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 20:10:41,663 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 20:10:41,664 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 20:10:41,664 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 20:10:43,487 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 20:10:43,487 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 20:10:43,487 [INFO] Запуск player_table_stats_etl.py
2025-06-22 20:10:47,770 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 20:10:47,770 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 20:10:47,770 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 20:12:56,060 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 20:12:56,060 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 20:12:56,061 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 20:12:56,061 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 20:12:56,061 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 20:22:56,061 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 20:22:56,062 [INFO] Запуск player_passport_etl.py
2025-06-22 20:22:56,700 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 20:22:56,700 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 20:22:56,700 [INFO] Запуск player_h2h_etl.py
2025-06-22 20:23:02,484 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 20:23:02,484 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 20:23:02,484 [INFO] Запуск player_resilience_etl.py
2025-06-22 20:23:48,903 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 20:23:48,903 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 20:23:48,903 [INFO] Запуск player_style_etl.py
2025-06-22 20:24:36,546 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Александр Федоров' 75.86009174311927]
 ['Степан Кутепов' 75.47241379310344]
 ['Дмитрий Суркин' 75.47169811320755]]
Топ-3 chaotic:  [['Антон Болохов' 77.45098039215686]
 ['Степан Долбилин' 76.77083333333333]
 ['Василий Перминов' 76.58333333333333]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 20:24:36,546 [INFO] player_style_etl.py успешно выполнен
2025-06-22 20:24:36,546 [INFO] Запуск player_fatigue_etl.py
2025-06-22 20:24:51,840 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 20:24:51,840 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 20:24:51,840 [INFO] Запуск player_elo_etl.py
2025-06-22 20:25:18,466 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 20:25:18,466 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 20:25:18,467 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 20:26:40,851 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 20:26:40,852 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 20:26:40,852 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 20:26:42,706 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 20:26:42,706 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 20:26:42,706 [INFO] Запуск player_table_stats_etl.py
2025-06-22 20:26:47,043 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 20:26:47,043 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 20:26:47,043 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 20:28:51,382 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 20:28:51,383 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 20:28:51,383 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 20:28:51,383 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 20:28:51,383 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 20:38:51,383 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 20:38:51,384 [INFO] Запуск player_passport_etl.py
2025-06-22 20:38:51,753 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 20:38:51,753 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 20:38:51,753 [INFO] Запуск player_h2h_etl.py
2025-06-22 20:38:56,593 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 20:38:56,594 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 20:38:56,594 [INFO] Запуск player_resilience_etl.py
2025-06-22 20:39:43,868 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 20:39:43,868 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 20:39:43,868 [INFO] Запуск player_style_etl.py
2025-06-22 20:40:34,108 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Александр Федоров' 75.86009174311927]
 ['Степан Кутепов' 75.47241379310344]
 ['Дмитрий Суркин' 75.47169811320755]]
Топ-3 chaotic:  [['Антон Болохов' 77.45098039215686]
 ['Степан Долбилин' 76.77083333333333]
 ['Василий Перминов' 76.58333333333333]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 20:40:34,108 [INFO] player_style_etl.py успешно выполнен
2025-06-22 20:40:34,108 [INFO] Запуск player_fatigue_etl.py
2025-06-22 20:40:51,923 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 20:40:51,923 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 20:40:51,923 [INFO] Запуск player_elo_etl.py
2025-06-22 20:41:22,503 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 20:41:22,503 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-22 20:41:22,503 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 20:41:22,503 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 20:42:35,669 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 20:42:35,669 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 20:42:35,669 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 20:42:37,503 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 20:42:37,503 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 20:42:37,503 [INFO] Запуск player_table_stats_etl.py
2025-06-22 20:42:41,955 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 20:42:41,955 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 20:42:41,955 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 20:44:47,881 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 20:44:47,881 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 20:44:47,881 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 20:44:47,881 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 20:54:47,882 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 20:54:47,882 [INFO] Запуск player_passport_etl.py
2025-06-22 20:54:48,281 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 20:54:48,281 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 20:54:48,281 [INFO] Запуск player_h2h_etl.py
2025-06-22 20:54:53,649 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 20:54:53,649 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 20:54:53,649 [INFO] Запуск player_resilience_etl.py
2025-06-22 20:55:41,546 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 20:55:41,546 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 20:55:41,546 [INFO] Запуск player_style_etl.py
2025-06-22 20:56:31,338 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 20:56:31,338 [INFO] player_style_etl.py успешно выполнен
2025-06-22 20:56:31,338 [INFO] Запуск player_fatigue_etl.py
2025-06-22 20:56:48,330 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 20:56:48,330 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 20:56:48,330 [INFO] Запуск player_elo_etl.py
2025-06-22 20:57:15,016 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 20:57:15,016 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 20:57:15,016 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 20:58:28,803 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 20:58:28,803 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 20:58:28,803 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 20:58:30,605 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 20:58:30,605 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 20:58:30,605 [INFO] Запуск player_table_stats_etl.py
2025-06-22 20:58:34,839 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 20:58:34,839 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 20:58:34,839 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 21:00:34,975 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 21:00:34,975 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 21:00:34,975 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 21:00:34,975 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 21:10:34,975 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 21:10:34,976 [INFO] Запуск player_passport_etl.py
2025-06-22 21:10:35,319 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 21:10:35,319 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 21:10:35,319 [INFO] Запуск player_h2h_etl.py
2025-06-22 21:10:39,751 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 21:10:39,751 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 21:10:39,751 [INFO] Запуск player_resilience_etl.py
2025-06-22 21:11:25,109 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 21:11:25,110 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 21:11:25,110 [INFO] Запуск player_style_etl.py
2025-06-22 21:12:17,343 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 21:12:17,343 [INFO] player_style_etl.py успешно выполнен
2025-06-22 21:12:17,343 [INFO] Запуск player_fatigue_etl.py
2025-06-22 21:12:29,665 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 21:12:29,665 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 21:12:29,665 [INFO] Запуск player_elo_etl.py
2025-06-22 21:12:58,494 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126076 записей (по всем матчам)
2025-06-22 21:12:58,495 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 21:12:58,495 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 21:14:12,099 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 21:14:12,100 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 21:14:12,100 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 21:14:13,872 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 21:14:13,872 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 21:14:13,873 [INFO] Запуск player_table_stats_etl.py
2025-06-22 21:14:18,137 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 21:14:18,138 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 21:14:18,138 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 21:16:01,337 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 21:16:01,337 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 21:16:01,337 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 21:16:01,337 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 21:26:01,337 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 21:26:01,338 [INFO] Запуск player_passport_etl.py
2025-06-22 21:26:05,290 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 21:26:05,290 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 21:26:05,291 [INFO] Запуск player_h2h_etl.py
2025-06-22 21:26:11,203 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 21:26:11,203 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 21:26:11,203 [INFO] Запуск player_resilience_etl.py
2025-06-22 21:26:56,823 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 21:26:56,823 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 21:26:56,823 [INFO] Запуск player_style_etl.py
2025-06-22 21:27:40,695 [INFO] [STDOUT] Топ-3 chaotic:  [['Александр Грибков' 76.9298245614035]
 ['Андрей Козырев' 76.79761904761905]
 ['Алексей Инназаров' 76.74898785425101]]
Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 21:27:40,696 [INFO] player_style_etl.py успешно выполнен
2025-06-22 21:27:40,696 [INFO] Запуск player_fatigue_etl.py
2025-06-22 21:27:55,076 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 21:27:55,076 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 21:27:55,076 [INFO] Запуск player_elo_etl.py
2025-06-22 21:28:34,513 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 21:28:34,513 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-22 21:28:34,514 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 21:28:34,514 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 21:29:50,947 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 21:29:50,947 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 21:29:50,947 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 21:29:52,677 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 21:29:52,677 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 21:29:52,677 [INFO] Запуск player_table_stats_etl.py
2025-06-22 21:29:56,666 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 21:29:56,666 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 21:29:56,667 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 21:31:53,228 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 21:31:53,228 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 21:31:53,229 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 21:31:53,229 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 21:41:53,229 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 21:41:53,229 [INFO] Запуск player_passport_etl.py
2025-06-22 21:41:58,141 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 21:41:58,141 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 21:41:58,141 [INFO] Запуск player_h2h_etl.py
2025-06-22 21:42:05,860 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 21:42:05,860 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 21:42:05,860 [INFO] Запуск player_resilience_etl.py
2025-06-22 21:42:51,382 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 21:42:51,382 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 21:42:51,382 [INFO] Запуск player_style_etl.py
2025-06-22 21:43:34,774 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-22 21:43:34,774 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-22 21:43:34,774 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-22 21:43:34,774 [INFO] Запуск player_fatigue_etl.py
2025-06-22 21:43:52,103 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 21:43:52,104 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 21:43:52,104 [INFO] Запуск player_elo_etl.py
2025-06-22 21:44:20,441 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 21:44:20,441 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 21:44:20,441 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 21:45:41,767 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 21:45:41,767 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 21:45:41,767 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 21:45:43,602 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 21:45:43,602 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 21:45:43,602 [INFO] Запуск player_table_stats_etl.py
2025-06-22 21:45:47,665 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 21:45:47,665 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 21:45:47,665 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 21:47:45,184 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 21:47:45,185 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 21:47:45,185 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 21:47:45,185 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 21:57:45,185 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 21:57:45,185 [INFO] Запуск player_passport_etl.py
2025-06-22 21:57:45,915 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 21:57:45,916 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 21:57:45,916 [INFO] Запуск player_h2h_etl.py
2025-06-22 21:57:53,421 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 21:57:53,422 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 21:57:53,422 [INFO] Запуск player_resilience_etl.py
2025-06-22 21:58:40,727 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 21:58:40,728 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 21:58:40,728 [INFO] Запуск player_style_etl.py
2025-06-22 21:59:20,897 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Степан Кутепов' 75.47241379310344]
 ['Сергей Константинов' 75.37061403508773]
 ['Алексей Строев' 75.2970711297071]]
Топ-3 chaotic:  [['Антон Болохов' 77.45098039215686]
 ['Степан Долбилин' 76.77083333333333]
 ['Василий Перминов' 76.58333333333333]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 21:59:20,897 [INFO] player_style_etl.py успешно выполнен
2025-06-22 21:59:20,897 [INFO] Запуск player_fatigue_etl.py
2025-06-22 21:59:34,147 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 21:59:34,148 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 21:59:34,148 [INFO] Запуск player_elo_etl.py
2025-06-22 22:00:02,122 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 22:00:02,122 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-22 22:00:02,122 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 22:00:02,122 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 22:01:27,302 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 22:01:27,302 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 22:01:27,302 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 22:01:29,067 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 22:01:29,067 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 22:01:29,067 [INFO] Запуск player_table_stats_etl.py
2025-06-22 22:01:33,305 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 22:01:33,305 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 22:01:33,306 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 22:03:29,893 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 22:03:29,893 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 22:03:29,893 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 22:03:29,893 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 22:03:29,893 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 22:13:29,894 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 22:13:29,894 [INFO] Запуск player_passport_etl.py
2025-06-22 22:13:32,567 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 22:13:32,567 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 22:13:32,568 [INFO] Запуск player_h2h_etl.py
2025-06-22 22:13:46,054 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-22 22:13:46,055 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-22 22:13:46,055 [INFO] Запуск player_resilience_etl.py
2025-06-22 22:14:32,324 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 22:14:32,324 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 22:14:32,324 [INFO] Запуск player_style_etl.py
2025-06-22 22:15:14,416 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 22:15:14,417 [INFO] player_style_etl.py успешно выполнен
2025-06-22 22:15:14,417 [INFO] Запуск player_fatigue_etl.py
2025-06-22 22:15:26,787 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 22:15:26,787 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 22:15:26,787 [INFO] Запуск player_elo_etl.py
2025-06-22 22:15:54,465 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 22:15:54,465 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-22 22:15:54,465 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 22:15:54,465 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 22:17:18,951 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 22:17:18,952 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 22:17:18,952 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 22:17:20,771 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 22:17:20,772 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 22:17:20,772 [INFO] Запуск player_table_stats_etl.py
2025-06-22 22:17:25,330 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 22:17:25,330 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 22:17:25,330 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 22:19:21,936 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 22:19:21,936 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 22:19:21,937 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 22:19:21,937 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 22:19:21,937 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 22:29:21,937 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 22:29:21,937 [INFO] Запуск player_passport_etl.py
2025-06-22 22:29:28,150 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 22:29:28,150 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 22:29:28,150 [INFO] Запуск player_h2h_etl.py
2025-06-22 22:29:33,828 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 22:29:33,828 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 22:29:33,828 [INFO] Запуск player_resilience_etl.py
2025-06-22 22:30:19,109 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 22:30:19,109 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 22:30:19,109 [INFO] Запуск player_style_etl.py
2025-06-22 22:31:02,950 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 22:31:02,950 [INFO] player_style_etl.py успешно выполнен
2025-06-22 22:31:02,950 [INFO] Запуск player_fatigue_etl.py
2025-06-22 22:31:14,237 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 22:31:14,237 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 22:31:14,237 [INFO] Запуск player_elo_etl.py
2025-06-22 22:31:41,385 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-22 22:31:41,385 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-22 22:31:41,385 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 22:31:41,385 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 22:33:04,766 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 22:33:04,767 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 22:33:04,767 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 22:33:06,549 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 22:33:06,549 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 22:33:06,549 [INFO] Запуск player_table_stats_etl.py
2025-06-22 22:33:10,717 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 22:33:10,717 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 22:33:10,717 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 22:35:10,455 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 22:35:10,455 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 22:35:10,455 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 22:35:10,456 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 22:35:10,456 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 22:45:10,456 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 22:45:10,456 [INFO] Запуск player_passport_etl.py
2025-06-22 22:45:12,728 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 22:45:12,728 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 22:45:12,729 [INFO] Запуск player_h2h_etl.py
2025-06-22 22:45:18,145 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 22:45:18,145 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 22:45:18,145 [INFO] Запуск player_resilience_etl.py
2025-06-22 22:46:03,233 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 22:46:03,233 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 22:46:03,234 [INFO] Запуск player_style_etl.py
2025-06-22 22:46:43,628 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 22:46:43,629 [INFO] player_style_etl.py успешно выполнен
2025-06-22 22:46:43,629 [INFO] Запуск player_fatigue_etl.py
2025-06-22 22:47:01,733 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-22 22:47:01,733 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-22 22:47:01,733 [INFO] Запуск player_elo_etl.py
2025-06-22 22:47:28,903 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 22:47:28,903 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 22:47:28,903 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 22:48:48,475 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 22:48:48,475 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 22:48:48,475 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 22:48:50,311 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 22:48:50,311 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 22:48:50,311 [INFO] Запуск player_table_stats_etl.py
2025-06-22 22:48:54,553 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 22:48:54,553 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 22:48:54,554 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 22:50:46,473 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 22:50:46,473 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 22:50:46,474 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 22:50:46,474 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 23:00:46,474 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 23:00:46,474 [INFO] Запуск player_passport_etl.py
2025-06-22 23:00:54,253 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-22 23:00:54,253 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 23:00:54,253 [INFO] Запуск player_h2h_etl.py
2025-06-22 23:00:59,741 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 23:00:59,741 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 23:00:59,741 [INFO] Запуск player_resilience_etl.py
2025-06-22 23:01:45,825 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 23:01:45,826 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 23:01:45,826 [INFO] Запуск player_style_etl.py
2025-06-22 23:02:26,556 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 23:02:26,556 [INFO] player_style_etl.py успешно выполнен
2025-06-22 23:02:26,557 [INFO] Запуск player_fatigue_etl.py
2025-06-22 23:02:38,358 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 23:02:38,358 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 23:02:38,359 [INFO] Запуск player_elo_etl.py
2025-06-22 23:03:05,993 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126110 записей (по всем матчам)
2025-06-22 23:03:05,993 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 23:03:05,993 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 23:04:29,745 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 23:04:29,745 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 23:04:29,745 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 23:04:31,496 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 23:04:31,496 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 23:04:31,496 [INFO] Запуск player_table_stats_etl.py
2025-06-22 23:04:35,567 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 23:04:35,567 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 23:04:35,567 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 23:06:25,267 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 23:06:25,268 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 23:06:25,268 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 23:06:25,268 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 23:16:25,268 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 23:16:25,268 [INFO] Запуск player_passport_etl.py
2025-06-22 23:16:33,336 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-22 23:16:33,336 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-22 23:16:33,336 [INFO] Запуск player_h2h_etl.py
2025-06-22 23:16:43,341 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 23:16:43,341 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 23:16:43,341 [INFO] Запуск player_resilience_etl.py
2025-06-22 23:17:28,241 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 23:17:28,241 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 23:17:28,242 [INFO] Запуск player_style_etl.py
2025-06-22 23:18:11,134 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 23:18:11,135 [INFO] player_style_etl.py успешно выполнен
2025-06-22 23:18:11,135 [INFO] Запуск player_fatigue_etl.py
2025-06-22 23:18:22,395 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 23:18:22,395 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 23:18:22,395 [INFO] Запуск player_elo_etl.py
2025-06-22 23:18:49,375 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-22 23:18:49,375 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-22 23:18:49,375 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 23:20:13,122 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 23:20:13,122 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 23:20:13,122 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 23:20:14,890 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 23:20:14,891 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 23:20:14,891 [INFO] Запуск player_table_stats_etl.py
2025-06-22 23:20:18,830 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 23:20:18,831 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 23:20:18,831 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 23:22:14,521 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 23:22:14,521 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 23:22:14,521 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 23:22:14,521 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 23:22:14,522 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 23:32:14,522 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 23:32:14,522 [INFO] Запуск player_passport_etl.py
2025-06-22 23:32:15,069 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 23:32:15,070 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 23:32:15,070 [INFO] Запуск player_h2h_etl.py
2025-06-22 23:32:24,191 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 23:32:24,191 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 23:32:24,191 [INFO] Запуск player_resilience_etl.py
2025-06-22 23:33:24,531 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 23:33:24,531 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 23:33:24,531 [INFO] Запуск player_style_etl.py
2025-06-22 23:33:58,972 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Михаил Свердлов' 75.25884543761639]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 23:33:58,972 [INFO] player_style_etl.py успешно выполнен
2025-06-22 23:33:58,972 [INFO] Запуск player_fatigue_etl.py
2025-06-22 23:34:10,433 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 23:34:10,433 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 23:34:10,433 [INFO] Запуск player_elo_etl.py
2025-06-22 23:34:40,208 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126124 записей (по всем матчам)
2025-06-22 23:34:40,208 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 23:34:40,208 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 23:35:59,703 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 23:35:59,703 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 23:35:59,703 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 23:36:08,542 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-22 23:36:08,542 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-22 23:36:08,542 [INFO] Запуск player_table_stats_etl.py
2025-06-22 23:36:15,586 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 23:36:15,586 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 23:36:15,586 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 23:38:13,436 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-22 23:38:13,436 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-22 23:38:13,436 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-22 23:38:13,436 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 23:38:13,436 [INFO] Ждём 10 минут до следующего запуска...
2025-06-22 23:48:13,437 [INFO] === Начало пакетного запуска ETL ===
2025-06-22 23:48:13,437 [INFO] Запуск player_passport_etl.py
2025-06-22 23:48:14,992 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-22 23:48:14,993 [INFO] player_passport_etl.py успешно выполнен
2025-06-22 23:48:14,993 [INFO] Запуск player_h2h_etl.py
2025-06-22 23:48:28,102 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-22 23:48:28,102 [INFO] player_h2h_etl.py успешно выполнен
2025-06-22 23:48:28,102 [INFO] Запуск player_resilience_etl.py
2025-06-22 23:49:32,756 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-22 23:49:32,756 [INFO] player_resilience_etl.py успешно выполнен
2025-06-22 23:49:32,756 [INFO] Запуск player_style_etl.py
2025-06-22 23:50:17,436 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.86009174311927]]
Топ-3 balanced:  [['Антон Боев' 75.40416666666667]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.14079422382672]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-22 23:50:17,436 [INFO] player_style_etl.py успешно выполнен
2025-06-22 23:50:17,437 [INFO] Запуск player_fatigue_etl.py
2025-06-22 23:50:29,794 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-22 23:50:29,795 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-22 23:50:29,795 [INFO] Запуск player_elo_etl.py
2025-06-22 23:50:49,056 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 126132 записей (по всем матчам)
2025-06-22 23:50:49,056 [INFO] player_elo_etl.py успешно выполнен
2025-06-22 23:50:49,056 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-22 23:52:10,355 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-22 23:52:10,356 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-22 23:52:10,356 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-22 23:52:15,423 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-22 23:52:15,423 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-22 23:52:15,424 [INFO] Запуск player_table_stats_etl.py
2025-06-22 23:52:21,156 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-22 23:52:21,156 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-22 23:52:21,156 [INFO] Запуск player_sos_windows_etl.py
2025-06-22 23:54:18,415 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-22 23:54:18,415 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-22 23:54:18,415 [INFO] === Пакетный запуск ETL завершён ===
2025-06-22 23:54:18,415 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 00:04:18,416 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 00:04:18,416 [INFO] Запуск player_passport_etl.py
2025-06-23 00:04:18,813 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 00:04:18,813 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 00:04:18,813 [INFO] Запуск player_h2h_etl.py
2025-06-23 00:04:25,034 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 00:04:25,034 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 00:04:25,034 [INFO] Запуск player_resilience_etl.py
2025-06-23 00:05:34,916 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 00:05:34,916 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 00:05:34,916 [INFO] Запуск player_style_etl.py
2025-06-23 00:06:25,775 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.90632318501171]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 00:06:25,775 [INFO] player_style_etl.py успешно выполнен
2025-06-23 00:06:25,775 [INFO] Запуск player_fatigue_etl.py
2025-06-23 00:06:41,837 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 00:06:41,838 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 00:06:41,838 [INFO] Запуск player_elo_etl.py
2025-06-23 00:07:05,904 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125790 записей (по всем матчам)
2025-06-23 00:07:05,904 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 00:07:05,904 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 00:08:30,378 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 00:08:30,378 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 00:08:30,378 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 00:08:39,215 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 00:08:39,215 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 00:08:39,215 [INFO] Запуск player_table_stats_etl.py
2025-06-23 00:08:46,156 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 00:08:46,156 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 00:08:46,156 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 00:10:52,990 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 00:10:52,990 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 00:10:52,990 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 00:10:52,990 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 00:20:52,991 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 00:20:52,991 [INFO] Запуск player_passport_etl.py
2025-06-23 00:20:53,497 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 00:20:53,497 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 00:20:53,497 [INFO] Запуск player_h2h_etl.py
2025-06-23 00:21:00,835 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 00:21:00,835 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 00:21:00,835 [INFO] Запуск player_resilience_etl.py
2025-06-23 00:21:59,292 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 00:21:59,293 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 00:21:59,293 [INFO] Запуск player_style_etl.py
2025-06-23 00:22:54,269 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.72897196261682]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 00:22:54,269 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 00:22:54,269 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 00:22:54,269 [INFO] Запуск player_fatigue_etl.py
2025-06-23 00:23:10,924 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 00:23:10,924 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 00:23:10,924 [INFO] Запуск player_elo_etl.py
2025-06-23 00:23:38,169 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125796 записей (по всем матчам)
2025-06-23 00:23:38,169 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 00:23:38,169 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 00:24:57,946 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 00:24:57,946 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 00:24:57,946 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 00:25:00,159 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 00:25:00,160 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 00:25:00,160 [INFO] Запуск player_table_stats_etl.py
2025-06-23 00:25:05,451 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 00:25:05,451 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 00:25:05,451 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 00:27:22,297 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 00:27:22,297 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 00:27:22,297 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 00:27:22,298 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 00:27:22,298 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 00:37:22,298 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 00:37:22,298 [INFO] Запуск player_passport_etl.py
2025-06-23 00:37:26,604 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 00:37:26,604 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 00:37:26,604 [INFO] Запуск player_h2h_etl.py
2025-06-23 00:37:41,777 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 00:37:41,778 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 00:37:41,778 [INFO] Запуск player_resilience_etl.py
2025-06-23 00:38:38,135 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 00:38:38,135 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 00:38:38,135 [INFO] Запуск player_style_etl.py
2025-06-23 00:39:28,685 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.73364485981308]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 00:39:28,685 [INFO] player_style_etl.py успешно выполнен
2025-06-23 00:39:28,686 [INFO] Запуск player_fatigue_etl.py
2025-06-23 00:39:46,866 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 00:39:46,866 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 00:39:46,866 [INFO] Запуск player_elo_etl.py
2025-06-23 00:40:16,708 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125798 записей (по всем матчам)
2025-06-23 00:40:16,708 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 00:40:16,708 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 00:41:46,767 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 00:41:46,768 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 00:41:46,768 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 00:41:48,985 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 00:41:48,985 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 00:41:48,985 [INFO] Запуск player_table_stats_etl.py
2025-06-23 00:41:54,303 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 00:41:54,303 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 00:41:54,303 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 00:44:00,520 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 00:44:00,520 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 00:44:00,520 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 00:44:00,520 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 00:54:00,521 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 00:54:00,521 [INFO] Запуск player_passport_etl.py
2025-06-23 00:54:06,494 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 00:54:06,495 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 00:54:06,495 [INFO] Запуск player_h2h_etl.py
2025-06-23 00:54:16,006 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 00:54:16,006 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 00:54:16,006 [INFO] Запуск player_resilience_etl.py
2025-06-23 00:55:22,306 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 00:55:22,307 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 00:55:22,307 [INFO] Запуск player_style_etl.py
2025-06-23 00:56:03,217 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.75]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 00:56:03,218 [INFO] player_style_etl.py успешно выполнен
2025-06-23 00:56:03,218 [INFO] Запуск player_fatigue_etl.py
2025-06-23 00:56:26,207 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 00:56:26,208 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 00:56:26,208 [INFO] Запуск player_elo_etl.py
2025-06-23 00:56:52,024 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125804 записей (по всем матчам)
2025-06-23 00:56:52,024 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 00:56:52,024 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 00:58:24,493 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 00:58:24,494 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 00:58:24,494 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 00:58:26,905 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 00:58:26,905 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 00:58:26,906 [INFO] Запуск player_table_stats_etl.py
2025-06-23 00:58:32,315 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 00:58:32,315 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 00:58:32,315 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 01:00:36,289 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 01:00:36,289 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 01:00:36,289 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 01:00:36,289 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 01:10:36,290 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 01:10:36,290 [INFO] Запуск player_passport_etl.py
2025-06-23 01:10:38,185 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 01:10:38,186 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 01:10:38,186 [INFO] Запуск player_h2h_etl.py
2025-06-23 01:10:49,535 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 01:10:49,535 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 01:10:49,535 [INFO] Запуск player_resilience_etl.py
2025-06-23 01:12:03,595 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 01:12:03,595 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 01:12:03,595 [INFO] Запуск player_style_etl.py
2025-06-23 01:12:47,742 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.75]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 01:12:47,742 [INFO] player_style_etl.py успешно выполнен
2025-06-23 01:12:47,742 [INFO] Запуск player_fatigue_etl.py
2025-06-23 01:13:01,532 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 01:13:01,532 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 01:13:01,532 [INFO] Запуск player_elo_etl.py
2025-06-23 01:13:40,114 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125806 записей (по всем матчам)
2025-06-23 01:13:40,114 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 01:13:40,114 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 01:15:23,896 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
2025-06-23 01:15:23,896 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-23 01:15:23,896 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-23 01:15:23,896 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 01:15:33,656 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 01:15:33,657 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 01:15:33,657 [INFO] Запуск player_table_stats_etl.py
2025-06-23 01:15:40,434 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 01:15:40,435 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 01:15:40,435 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 01:17:30,339 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 01:17:30,339 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 01:17:30,339 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 01:17:30,339 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 01:27:30,340 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 01:27:30,340 [INFO] Запуск player_passport_etl.py
2025-06-23 01:27:33,110 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 01:27:33,110 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 01:27:33,110 [INFO] Запуск player_h2h_etl.py
2025-06-23 01:27:38,605 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 01:27:38,605 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 01:27:38,605 [INFO] Запуск player_resilience_etl.py
2025-06-23 01:28:39,797 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 01:28:39,797 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 01:28:39,797 [INFO] Запуск player_style_etl.py
2025-06-23 01:29:17,563 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.75]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 01:29:17,564 [INFO] player_style_etl.py успешно выполнен
2025-06-23 01:29:17,564 [INFO] Запуск player_fatigue_etl.py
2025-06-23 01:29:27,261 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 01:29:27,261 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 01:29:27,261 [INFO] Запуск player_elo_etl.py
2025-06-23 01:29:44,697 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125810 записей (по всем матчам)
2025-06-23 01:29:44,697 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 01:29:44,697 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 01:31:07,824 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 01:31:07,824 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 01:31:07,824 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 01:31:09,801 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 01:31:09,801 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 01:31:09,801 [INFO] Запуск player_table_stats_etl.py
2025-06-23 01:31:16,235 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 01:31:16,235 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 01:31:16,235 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 01:33:04,427 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 01:33:04,427 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 01:33:04,427 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 01:33:04,427 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 01:43:04,428 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 01:43:04,428 [INFO] Запуск player_passport_etl.py
2025-06-23 01:43:04,802 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 01:43:04,803 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 01:43:04,803 [INFO] Запуск player_h2h_etl.py
2025-06-23 01:43:10,004 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 01:43:10,004 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 01:43:10,004 [INFO] Запуск player_resilience_etl.py
2025-06-23 01:44:03,596 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 01:44:03,596 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 01:44:03,596 [INFO] Запуск player_style_etl.py
2025-06-23 01:44:46,657 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.75]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 01:44:46,658 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 01:44:46,658 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 01:44:46,658 [INFO] Запуск player_fatigue_etl.py
2025-06-23 01:45:02,412 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 01:45:02,412 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 01:45:02,412 [INFO] Запуск player_elo_etl.py
2025-06-23 01:45:28,970 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125810 записей (по всем матчам)
2025-06-23 01:45:28,970 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 01:45:28,970 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 01:46:46,634 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
2025-06-23 01:46:46,635 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-23 01:46:46,635 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-23 01:46:46,635 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 01:46:48,930 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 01:46:48,931 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 01:46:48,931 [INFO] Запуск player_table_stats_etl.py
2025-06-23 01:47:00,528 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 01:47:00,528 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 01:47:00,528 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 01:49:01,461 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 01:49:01,462 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 01:49:01,462 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 01:49:01,462 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 01:59:01,462 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 01:59:01,462 [INFO] Запуск player_passport_etl.py
2025-06-23 01:59:01,812 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 01:59:01,812 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 01:59:01,812 [INFO] Запуск player_h2h_etl.py
2025-06-23 01:59:06,541 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 01:59:06,541 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 01:59:06,541 [INFO] Запуск player_resilience_etl.py
2025-06-23 02:00:06,589 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 02:00:06,589 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 02:00:06,590 [INFO] Запуск player_style_etl.py
2025-06-23 02:00:53,010 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.58275058275058]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 02:00:53,010 [INFO] player_style_etl.py успешно выполнен
2025-06-23 02:00:53,011 [INFO] Запуск player_fatigue_etl.py
2025-06-23 02:01:05,754 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 02:01:05,754 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 02:01:05,754 [INFO] Запуск player_elo_etl.py
2025-06-23 02:01:33,068 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 02:01:33,068 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-23 02:01:33,068 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 02:01:33,069 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 02:02:42,504 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 02:02:42,504 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 02:02:42,505 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 02:02:44,324 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 02:02:44,324 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 02:02:44,324 [INFO] Запуск player_table_stats_etl.py
2025-06-23 02:02:48,518 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 02:02:48,518 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 02:02:48,518 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 02:04:56,851 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 02:04:56,851 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 02:04:56,851 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 02:04:56,851 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 02:04:56,851 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 02:14:56,852 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 02:14:56,852 [INFO] Запуск player_passport_etl.py
2025-06-23 02:15:04,631 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-23 02:15:04,631 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-23 02:15:04,631 [INFO] Запуск player_h2h_etl.py
2025-06-23 02:15:10,225 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 02:15:10,226 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 02:15:10,226 [INFO] Запуск player_resilience_etl.py
2025-06-23 02:16:00,213 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 02:16:00,213 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 02:16:00,214 [INFO] Запуск player_style_etl.py
2025-06-23 02:16:42,861 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.58741258741259]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 02:16:42,862 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 02:16:42,862 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 02:16:42,862 [INFO] Запуск player_fatigue_etl.py
2025-06-23 02:17:00,843 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 02:17:00,843 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 02:17:00,843 [INFO] Запуск player_elo_etl.py
2025-06-23 02:17:27,919 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-23 02:17:27,919 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 02:17:27,919 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 02:18:51,395 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 02:18:51,395 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 02:18:51,395 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 02:18:53,179 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 02:18:53,179 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 02:18:53,180 [INFO] Запуск player_table_stats_etl.py
2025-06-23 02:18:57,408 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 02:18:57,409 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 02:18:57,409 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 02:20:45,495 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 02:20:45,495 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 02:20:45,495 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 02:20:45,495 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 02:30:45,496 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 02:30:45,496 [INFO] Запуск player_passport_etl.py
2025-06-23 02:30:52,431 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 02:30:52,431 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 02:30:52,431 [INFO] Запуск player_h2h_etl.py
2025-06-23 02:31:05,055 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 02:31:05,055 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 02:31:05,055 [INFO] Запуск player_resilience_etl.py
2025-06-23 02:32:06,556 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 02:32:06,556 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 02:32:06,556 [INFO] Запуск player_style_etl.py
2025-06-23 02:32:42,369 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Александр Федоров' 75.58741258741259]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 02:32:42,369 [INFO] player_style_etl.py успешно выполнен
2025-06-23 02:32:42,369 [INFO] Запуск player_fatigue_etl.py
2025-06-23 02:32:51,808 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 02:32:51,809 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 02:32:51,809 [INFO] Запуск player_elo_etl.py
2025-06-23 02:33:09,052 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125824 записей (по всем матчам)
2025-06-23 02:33:09,052 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 02:33:09,052 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 02:34:34,718 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 02:34:34,718 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 02:34:34,718 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 02:34:43,700 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 02:34:43,700 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 02:34:43,700 [INFO] Запуск player_table_stats_etl.py
2025-06-23 02:34:55,736 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 02:34:55,736 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 02:34:55,737 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 02:36:46,331 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 02:36:46,331 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 02:36:46,331 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 02:36:46,332 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 02:36:46,332 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 02:46:46,332 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 02:46:46,332 [INFO] Запуск player_passport_etl.py
2025-06-23 02:46:47,704 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 02:46:47,704 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 02:46:47,704 [INFO] Запуск player_h2h_etl.py
2025-06-23 02:47:00,592 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 02:47:00,592 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 02:47:00,592 [INFO] Запуск player_resilience_etl.py
2025-06-23 02:48:06,809 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 02:48:06,809 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 02:48:06,809 [INFO] Запуск player_style_etl.py
2025-06-23 02:48:54,661 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 02:48:54,661 [INFO] player_style_etl.py успешно выполнен
2025-06-23 02:48:54,661 [INFO] Запуск player_fatigue_etl.py
2025-06-23 02:49:05,920 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 02:49:05,920 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 02:49:05,920 [INFO] Запуск player_elo_etl.py
2025-06-23 02:49:23,519 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125828 записей (по всем матчам)
2025-06-23 02:49:23,519 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 02:49:23,519 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 02:50:34,084 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 02:50:34,084 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 02:50:34,084 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 02:50:36,253 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 02:50:36,254 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 02:50:36,254 [INFO] Запуск player_table_stats_etl.py
2025-06-23 02:50:47,773 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 02:50:47,773 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 02:50:47,773 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 02:52:47,026 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 02:52:47,026 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 02:52:47,026 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 02:52:47,026 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 03:02:47,027 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 03:02:47,027 [INFO] Запуск player_passport_etl.py
2025-06-23 03:02:47,398 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 03:02:47,398 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 03:02:47,398 [INFO] Запуск player_h2h_etl.py
2025-06-23 03:02:52,539 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 03:02:52,540 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 03:02:52,540 [INFO] Запуск player_resilience_etl.py
2025-06-23 03:03:48,590 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 03:03:48,590 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 03:03:48,590 [INFO] Запуск player_style_etl.py
2025-06-23 03:04:40,120 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 03:04:40,120 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 03:04:40,120 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 03:04:40,120 [INFO] Запуск player_fatigue_etl.py
2025-06-23 03:04:53,056 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 03:04:53,056 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 03:04:53,056 [INFO] Запуск player_elo_etl.py
2025-06-23 03:05:26,364 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 03:05:26,364 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 03:05:26,365 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 03:05:26,365 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 03:06:39,220 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 03:06:39,220 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 03:06:39,220 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 03:06:41,049 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 03:06:41,049 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 03:06:41,049 [INFO] Запуск player_table_stats_etl.py
2025-06-23 03:06:45,516 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 03:06:45,516 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 03:06:45,516 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 03:08:42,027 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 03:08:42,028 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 03:08:42,028 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 03:08:42,028 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 03:18:42,028 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 03:18:42,028 [INFO] Запуск player_passport_etl.py
2025-06-23 03:18:47,506 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 03:18:47,506 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 03:18:47,507 [INFO] Запуск player_h2h_etl.py
2025-06-23 03:19:00,852 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 03:19:00,852 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 03:19:00,852 [INFO] Запуск player_resilience_etl.py
2025-06-23 03:19:53,357 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 03:19:53,357 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 03:19:53,357 [INFO] Запуск player_style_etl.py
2025-06-23 03:20:31,194 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 03:20:31,194 [INFO] player_style_etl.py успешно выполнен
2025-06-23 03:20:31,194 [INFO] Запуск player_fatigue_etl.py
2025-06-23 03:20:50,261 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 03:20:50,261 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 03:20:50,261 [INFO] Запуск player_elo_etl.py
2025-06-23 03:21:19,281 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125834 записей (по всем матчам)
2025-06-23 03:21:19,281 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 03:21:19,281 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 03:22:43,573 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 03:22:43,573 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 03:22:43,573 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 03:22:49,442 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 03:22:49,442 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 03:22:49,443 [INFO] Запуск player_table_stats_etl.py
2025-06-23 03:22:53,742 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 03:22:53,742 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 03:22:53,742 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 03:24:42,747 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 03:24:42,747 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 03:24:42,748 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 03:24:42,748 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 03:34:42,748 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 03:34:42,748 [INFO] Запуск player_passport_etl.py
2025-06-23 03:34:49,732 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 03:34:49,732 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 03:34:49,732 [INFO] Запуск player_h2h_etl.py
2025-06-23 03:35:03,275 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 03:35:03,276 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 03:35:03,276 [INFO] Запуск player_resilience_etl.py
2025-06-23 03:36:07,117 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 03:36:07,117 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 03:36:07,117 [INFO] Запуск player_style_etl.py
2025-06-23 03:36:44,765 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 03:36:44,766 [INFO] player_style_etl.py успешно выполнен
2025-06-23 03:36:44,766 [INFO] Запуск player_fatigue_etl.py
2025-06-23 03:36:55,162 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 03:36:55,162 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 03:36:55,162 [INFO] Запуск player_elo_etl.py
2025-06-23 03:37:12,994 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125836 записей (по всем матчам)
2025-06-23 03:37:12,994 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 03:37:12,994 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 03:38:35,967 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 03:38:35,967 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 03:38:35,967 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 03:38:43,029 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 03:38:43,029 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 03:38:43,029 [INFO] Запуск player_table_stats_etl.py
2025-06-23 03:38:54,179 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 03:38:54,179 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 03:38:54,179 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 03:40:36,289 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 03:40:36,289 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 03:40:36,289 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 03:40:36,290 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 03:50:36,290 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 03:50:36,290 [INFO] Запуск player_passport_etl.py
2025-06-23 03:50:36,644 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 03:50:36,645 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 03:50:36,645 [INFO] Запуск player_h2h_etl.py
2025-06-23 03:50:40,970 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 03:50:40,970 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 03:50:40,970 [INFO] Запуск player_resilience_etl.py
2025-06-23 03:51:41,442 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 03:51:41,442 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 03:51:41,442 [INFO] Запуск player_style_etl.py
2025-06-23 03:52:31,660 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 03:52:31,661 [INFO] player_style_etl.py успешно выполнен
2025-06-23 03:52:31,661 [INFO] Запуск player_fatigue_etl.py
2025-06-23 03:52:47,543 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 03:52:47,543 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 03:52:47,543 [INFO] Запуск player_elo_etl.py
2025-06-23 03:53:06,511 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125840 записей (по всем матчам)
2025-06-23 03:53:06,511 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 03:53:06,511 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 03:54:12,275 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 03:54:12,275 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 03:54:12,275 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 03:54:14,338 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 03:54:14,338 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 03:54:14,338 [INFO] Запуск player_table_stats_etl.py
2025-06-23 03:54:20,644 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 03:54:20,644 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 03:54:20,644 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 03:56:24,881 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 03:56:24,881 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 03:56:24,881 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 03:56:24,881 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 04:06:24,882 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 04:06:24,882 [INFO] Запуск player_passport_etl.py
2025-06-23 04:06:25,222 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 04:06:25,222 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 04:06:25,222 [INFO] Запуск player_h2h_etl.py
2025-06-23 04:06:29,378 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 04:06:29,378 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 04:06:29,378 [INFO] Запуск player_resilience_etl.py
2025-06-23 04:07:14,325 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 04:07:14,326 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 04:07:14,326 [INFO] Запуск player_style_etl.py
2025-06-23 04:07:54,721 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 04:07:54,722 [INFO] player_style_etl.py успешно выполнен
2025-06-23 04:07:54,722 [INFO] Запуск player_fatigue_etl.py
2025-06-23 04:08:12,295 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 04:08:12,295 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 04:08:12,295 [INFO] Запуск player_elo_etl.py
2025-06-23 04:08:38,177 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125842 записей (по всем матчам)
2025-06-23 04:08:38,177 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 04:08:38,177 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 04:09:56,941 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 04:09:56,942 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 04:09:56,942 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 04:09:58,683 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 04:09:58,683 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 04:09:58,683 [INFO] Запуск player_table_stats_etl.py
2025-06-23 04:10:02,648 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 04:10:02,648 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 04:10:02,648 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 04:11:54,571 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 04:11:54,571 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 04:11:54,571 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 04:11:54,571 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 04:21:54,572 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 04:21:54,572 [INFO] Запуск player_passport_etl.py
2025-06-23 04:21:59,809 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 04:21:59,809 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 04:21:59,809 [INFO] Запуск player_h2h_etl.py
2025-06-23 04:22:11,801 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 04:22:11,802 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 04:22:11,802 [INFO] Запуск player_resilience_etl.py
2025-06-23 04:23:09,755 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 04:23:09,755 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 04:23:09,755 [INFO] Запуск player_style_etl.py
2025-06-23 04:23:42,377 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 04:23:42,377 [INFO] player_style_etl.py успешно выполнен
2025-06-23 04:23:42,377 [INFO] Запуск player_fatigue_etl.py
2025-06-23 04:23:51,064 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 04:23:51,065 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 04:23:51,065 [INFO] Запуск player_elo_etl.py
2025-06-23 04:24:18,494 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 04:24:18,494 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 04:24:18,494 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 04:24:18,494 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 04:25:42,265 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 04:25:42,265 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 04:25:42,266 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 04:25:49,102 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 04:25:49,102 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 04:25:49,102 [INFO] Запуск player_table_stats_etl.py
2025-06-23 04:26:00,470 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 04:26:00,470 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 04:26:00,470 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 04:27:49,547 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 04:27:49,548 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 04:27:49,548 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 04:27:49,548 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 04:27:49,548 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 04:37:49,548 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 04:37:49,549 [INFO] Запуск player_passport_etl.py
2025-06-23 04:37:54,303 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 04:37:54,303 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 04:37:54,303 [INFO] Запуск player_h2h_etl.py
2025-06-23 04:38:01,044 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 04:38:01,044 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 04:38:01,044 [INFO] Запуск player_resilience_etl.py
2025-06-23 04:39:03,138 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 04:39:03,138 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 04:39:03,138 [INFO] Запуск player_style_etl.py
2025-06-23 04:39:45,894 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 04:39:45,895 [INFO] player_style_etl.py успешно выполнен
2025-06-23 04:39:45,895 [INFO] Запуск player_fatigue_etl.py
2025-06-23 04:39:54,688 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 04:39:54,688 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 04:39:54,688 [INFO] Запуск player_elo_etl.py
2025-06-23 04:40:11,126 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125846 записей (по всем матчам)
2025-06-23 04:40:11,126 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 04:40:11,126 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 04:41:25,439 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 04:41:25,439 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 04:41:25,439 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 04:41:27,669 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 04:41:27,670 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 04:41:27,670 [INFO] Запуск player_table_stats_etl.py
2025-06-23 04:41:38,051 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 04:41:38,052 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 04:41:38,052 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 04:43:31,990 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 04:43:31,991 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 04:43:31,991 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 04:43:31,991 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 04:53:31,991 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 04:53:31,991 [INFO] Запуск player_passport_etl.py
2025-06-23 04:53:33,411 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 04:53:33,411 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 04:53:33,411 [INFO] Запуск player_h2h_etl.py
2025-06-23 04:53:37,449 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 04:53:37,449 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 04:53:37,449 [INFO] Запуск player_resilience_etl.py
2025-06-23 04:54:31,365 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 04:54:31,365 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 04:54:31,365 [INFO] Запуск player_style_etl.py
2025-06-23 04:55:25,686 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 04:55:25,686 [INFO] player_style_etl.py успешно выполнен
2025-06-23 04:55:25,686 [INFO] Запуск player_fatigue_etl.py
2025-06-23 04:55:43,498 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 04:55:43,499 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 04:55:43,499 [INFO] Запуск player_elo_etl.py
2025-06-23 04:56:08,131 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125852 записей (по всем матчам)
2025-06-23 04:56:08,131 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 04:56:08,131 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 04:57:13,280 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 04:57:13,281 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 04:57:13,281 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 04:57:15,001 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 04:57:15,001 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 04:57:15,002 [INFO] Запуск player_table_stats_etl.py
2025-06-23 04:57:19,001 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 04:57:19,001 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 04:57:19,001 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 04:59:22,084 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 04:59:22,085 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 04:59:22,085 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 04:59:22,085 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 05:09:22,085 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 05:09:22,085 [INFO] Запуск player_passport_etl.py
2025-06-23 05:09:29,869 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-23 05:09:29,869 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-23 05:09:29,869 [INFO] Запуск player_h2h_etl.py
2025-06-23 05:09:39,683 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 05:09:39,683 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 05:09:39,683 [INFO] Запуск player_resilience_etl.py
2025-06-23 05:10:25,786 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 05:10:25,786 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 05:10:25,786 [INFO] Запуск player_style_etl.py
2025-06-23 05:11:08,733 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 05:11:08,733 [INFO] player_style_etl.py успешно выполнен
2025-06-23 05:11:08,734 [INFO] Запуск player_fatigue_etl.py
2025-06-23 05:11:26,325 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 05:11:26,325 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 05:11:26,325 [INFO] Запуск player_elo_etl.py
2025-06-23 05:11:50,286 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125856 записей (по всем матчам)
2025-06-23 05:11:50,287 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 05:11:50,287 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 05:13:11,544 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 05:13:11,544 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 05:13:11,545 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 05:13:13,298 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 05:13:13,298 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 05:13:13,299 [INFO] Запуск player_table_stats_etl.py
2025-06-23 05:13:17,297 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 05:13:17,297 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 05:13:17,297 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 05:15:10,074 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 05:15:10,074 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 05:15:10,074 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 05:15:10,074 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 05:15:10,074 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 05:25:10,075 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 05:25:10,075 [INFO] Запуск player_passport_etl.py
2025-06-23 05:25:14,211 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 05:25:14,212 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 05:25:14,212 [INFO] Запуск player_h2h_etl.py
2025-06-23 05:25:26,230 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 05:25:26,230 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 05:25:26,230 [INFO] Запуск player_resilience_etl.py
2025-06-23 05:26:25,313 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 05:26:25,313 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 05:26:25,313 [INFO] Запуск player_style_etl.py
2025-06-23 05:26:57,500 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 05:26:57,500 [INFO] player_style_etl.py успешно выполнен
2025-06-23 05:26:57,500 [INFO] Запуск player_fatigue_etl.py
2025-06-23 05:27:06,177 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 05:27:06,177 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 05:27:06,177 [INFO] Запуск player_elo_etl.py
2025-06-23 05:27:22,419 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 05:27:22,419 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 05:27:22,419 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 05:28:45,677 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 05:28:45,677 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 05:28:45,677 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 05:28:54,808 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 05:28:54,808 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 05:28:54,808 [INFO] Запуск player_table_stats_etl.py
2025-06-23 05:29:00,641 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 05:29:00,641 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 05:29:00,641 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 05:30:42,693 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 05:30:42,694 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 05:30:42,694 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 05:30:42,694 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 05:40:42,694 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 05:40:42,695 [INFO] Запуск player_passport_etl.py
2025-06-23 05:40:44,370 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 05:40:44,370 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 05:40:44,370 [INFO] Запуск player_h2h_etl.py
2025-06-23 05:40:49,662 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 05:40:49,662 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 05:40:49,662 [INFO] Запуск player_resilience_etl.py
2025-06-23 05:41:51,848 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 05:41:51,848 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 05:41:51,848 [INFO] Запуск player_style_etl.py
2025-06-23 05:42:41,917 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 05:42:41,917 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 05:42:41,917 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 05:42:41,917 [INFO] Запуск player_fatigue_etl.py
2025-06-23 05:42:59,943 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 05:42:59,943 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 05:42:59,943 [INFO] Запуск player_elo_etl.py
2025-06-23 05:43:16,808 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 05:43:16,809 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 05:43:16,809 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 05:44:22,799 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 05:44:22,799 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 05:44:22,799 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 05:44:28,020 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 05:44:28,021 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 05:44:28,021 [INFO] Запуск player_table_stats_etl.py
2025-06-23 05:44:39,674 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 05:44:39,674 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 05:44:39,674 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 05:46:35,561 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 05:46:35,561 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 05:46:35,561 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 05:46:35,561 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 05:56:35,562 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 05:56:35,562 [INFO] Запуск player_passport_etl.py
2025-06-23 05:56:35,899 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 05:56:35,899 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 05:56:35,899 [INFO] Запуск player_h2h_etl.py
2025-06-23 05:56:40,009 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 05:56:40,009 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 05:56:40,009 [INFO] Запуск player_resilience_etl.py
2025-06-23 05:57:33,910 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 05:57:33,910 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 05:57:33,910 [INFO] Запуск player_style_etl.py
2025-06-23 05:58:17,418 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 05:58:17,419 [INFO] player_style_etl.py успешно выполнен
2025-06-23 05:58:17,419 [INFO] Запуск player_fatigue_etl.py
2025-06-23 05:58:31,356 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 05:58:31,356 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 05:58:31,357 [INFO] Запуск player_elo_etl.py
2025-06-23 05:58:55,004 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 05:58:55,005 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 05:58:55,005 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 06:00:06,808 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 06:00:06,808 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 06:00:06,808 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 06:00:08,522 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 06:00:08,522 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 06:00:08,522 [INFO] Запуск player_table_stats_etl.py
2025-06-23 06:00:12,575 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 06:00:12,575 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 06:00:12,575 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 06:02:07,796 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 06:02:07,797 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 06:02:07,797 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 06:02:07,797 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 06:12:07,797 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 06:12:07,798 [INFO] Запуск player_passport_etl.py
2025-06-23 06:12:09,101 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 06:12:09,101 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 06:12:09,101 [INFO] Запуск player_h2h_etl.py
2025-06-23 06:12:21,269 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 06:12:21,269 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 06:12:21,269 [INFO] Запуск player_resilience_etl.py
2025-06-23 06:13:14,963 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 06:13:14,963 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 06:13:14,963 [INFO] Запуск player_style_etl.py
2025-06-23 06:13:46,737 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 06:13:46,737 [INFO] player_style_etl.py успешно выполнен
2025-06-23 06:13:46,737 [INFO] Запуск player_fatigue_etl.py
2025-06-23 06:13:55,229 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 06:13:55,229 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 06:13:55,229 [INFO] Запуск player_elo_etl.py
2025-06-23 06:14:27,312 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 06:14:27,312 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-23 06:14:27,312 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 06:14:27,312 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 06:15:52,122 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 06:15:52,122 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 06:15:52,123 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 06:15:57,328 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 06:15:57,329 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 06:15:57,329 [INFO] Запуск player_table_stats_etl.py
2025-06-23 06:16:03,049 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 06:16:03,049 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 06:16:03,049 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 06:17:47,647 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 06:17:47,647 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 06:17:47,647 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 06:17:47,647 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 06:27:47,648 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 06:27:47,648 [INFO] Запуск player_passport_etl.py
2025-06-23 06:27:48,711 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 06:27:48,711 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 06:27:48,711 [INFO] Запуск player_h2h_etl.py
2025-06-23 06:27:54,263 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 06:27:54,263 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 06:27:54,263 [INFO] Запуск player_resilience_etl.py
2025-06-23 06:28:58,023 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 06:28:58,023 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 06:28:58,023 [INFO] Запуск player_style_etl.py
2025-06-23 06:29:40,892 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 06:29:40,892 [INFO] player_style_etl.py успешно выполнен
2025-06-23 06:29:40,892 [INFO] Запуск player_fatigue_etl.py
2025-06-23 06:29:49,682 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 06:29:49,682 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 06:29:49,682 [INFO] Запуск player_elo_etl.py
2025-06-23 06:30:06,590 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 06:30:06,590 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 06:30:06,590 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 06:31:21,265 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 06:31:21,266 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 06:31:21,266 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 06:31:23,902 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 06:31:23,902 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 06:31:23,902 [INFO] Запуск player_table_stats_etl.py
2025-06-23 06:31:35,622 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 06:31:35,622 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 06:31:35,622 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 06:33:29,142 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 06:33:29,143 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 06:33:29,143 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 06:33:29,143 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 06:43:29,143 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 06:43:29,143 [INFO] Запуск player_passport_etl.py
2025-06-23 06:43:29,483 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 06:43:29,483 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 06:43:29,483 [INFO] Запуск player_h2h_etl.py
2025-06-23 06:43:33,600 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 06:43:33,600 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 06:43:33,600 [INFO] Запуск player_resilience_etl.py
2025-06-23 06:44:32,249 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 06:44:32,249 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 06:44:32,249 [INFO] Запуск player_style_etl.py
2025-06-23 06:45:16,793 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 06:45:16,793 [INFO] player_style_etl.py успешно выполнен
2025-06-23 06:45:16,793 [INFO] Запуск player_fatigue_etl.py
2025-06-23 06:45:32,549 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 06:45:32,549 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 06:45:32,549 [INFO] Запуск player_elo_etl.py
2025-06-23 06:46:01,131 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 06:46:01,132 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 06:46:01,132 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 06:46:01,132 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 06:47:06,386 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 06:47:06,386 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 06:47:06,386 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 06:47:08,126 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 06:47:08,126 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 06:47:08,126 [INFO] Запуск player_table_stats_etl.py
2025-06-23 06:47:13,081 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 06:47:13,081 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 06:47:13,081 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 06:49:14,305 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 06:49:14,306 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 06:49:14,306 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 06:49:14,306 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 06:59:14,306 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 06:59:14,306 [INFO] Запуск player_passport_etl.py
2025-06-23 06:59:19,286 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 06:59:19,286 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 06:59:19,286 [INFO] Запуск player_h2h_etl.py
2025-06-23 06:59:26,376 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 06:59:26,376 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 06:59:26,376 [INFO] Запуск player_resilience_etl.py
2025-06-23 07:00:14,243 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 07:00:14,244 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 07:00:14,244 [INFO] Запуск player_style_etl.py
2025-06-23 07:00:57,522 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 07:00:57,523 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 07:00:57,523 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 07:00:57,523 [INFO] Запуск player_fatigue_etl.py
2025-06-23 07:01:15,392 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 07:01:15,392 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 07:01:15,392 [INFO] Запуск player_elo_etl.py
2025-06-23 07:01:37,062 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 07:01:37,062 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 07:01:37,062 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 07:03:00,364 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 07:03:00,364 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 07:03:00,364 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 07:03:02,107 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 07:03:02,107 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 07:03:02,107 [INFO] Запуск player_table_stats_etl.py
2025-06-23 07:03:06,184 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 07:03:06,184 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 07:03:06,184 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 07:04:53,682 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 07:04:53,682 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 07:04:53,682 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 07:04:53,682 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 07:14:53,683 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 07:14:53,683 [INFO] Запуск player_passport_etl.py
2025-06-23 07:14:59,424 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 07:14:59,424 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 07:14:59,424 [INFO] Запуск player_h2h_etl.py
2025-06-23 07:15:04,513 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 07:15:04,513 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 07:15:04,513 [INFO] Запуск player_resilience_etl.py
2025-06-23 07:16:13,239 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 07:16:13,239 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 07:16:13,239 [INFO] Запуск player_style_etl.py
2025-06-23 07:16:47,494 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 07:16:47,494 [INFO] player_style_etl.py успешно выполнен
2025-06-23 07:16:47,494 [INFO] Запуск player_fatigue_etl.py
2025-06-23 07:16:56,162 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 07:16:56,162 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 07:16:56,162 [INFO] Запуск player_elo_etl.py
2025-06-23 07:17:12,759 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125858 записей (по всем матчам)
2025-06-23 07:17:12,759 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 07:17:12,759 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 07:18:36,661 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 07:18:36,661 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 07:18:36,662 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 07:18:39,078 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 07:18:39,078 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 07:18:39,078 [INFO] Запуск player_table_stats_etl.py
2025-06-23 07:18:43,945 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 07:18:43,946 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 07:18:43,946 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 07:20:29,397 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 07:20:29,397 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 07:20:29,397 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 07:20:29,397 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 07:30:29,398 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 07:30:29,398 [INFO] Запуск player_passport_etl.py
2025-06-23 07:30:29,733 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 07:30:29,733 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 07:30:29,733 [INFO] Запуск player_h2h_etl.py
2025-06-23 07:30:35,239 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 07:30:35,239 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 07:30:35,239 [INFO] Запуск player_resilience_etl.py
2025-06-23 07:31:37,395 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 07:31:37,396 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 07:31:37,396 [INFO] Запуск player_style_etl.py
2025-06-23 07:32:22,412 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 07:32:22,412 [INFO] player_style_etl.py успешно выполнен
2025-06-23 07:32:22,412 [INFO] Запуск player_fatigue_etl.py
2025-06-23 07:32:38,014 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 07:32:38,014 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 07:32:38,014 [INFO] Запуск player_elo_etl.py
2025-06-23 07:32:56,840 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125860 записей (по всем матчам)
2025-06-23 07:32:56,841 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 07:32:56,841 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 07:34:01,811 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 07:34:01,812 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 07:34:01,812 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 07:34:09,075 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 07:34:09,076 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 07:34:09,076 [INFO] Запуск player_table_stats_etl.py
2025-06-23 07:34:14,095 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 07:34:14,095 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 07:34:14,095 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 07:36:13,332 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 07:36:13,332 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 07:36:13,333 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 07:36:13,333 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 07:46:13,333 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 07:46:13,333 [INFO] Запуск player_passport_etl.py
2025-06-23 07:46:13,681 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 07:46:13,681 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 07:46:13,682 [INFO] Запуск player_h2h_etl.py
2025-06-23 07:46:18,049 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 07:46:18,049 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 07:46:18,049 [INFO] Запуск player_resilience_etl.py
2025-06-23 07:47:03,310 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 07:47:03,310 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 07:47:03,310 [INFO] Запуск player_style_etl.py
2025-06-23 07:47:54,167 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 07:47:54,168 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 07:47:54,168 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 07:47:54,168 [INFO] Запуск player_fatigue_etl.py
2025-06-23 07:48:12,263 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 07:48:12,263 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 07:48:12,263 [INFO] Запуск player_elo_etl.py
2025-06-23 07:48:41,144 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 07:48:41,145 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 07:48:41,145 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 07:48:41,145 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 07:49:54,213 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 07:49:54,213 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 07:49:54,213 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 07:49:55,952 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 07:49:55,953 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 07:49:55,953 [INFO] Запуск player_table_stats_etl.py
2025-06-23 07:50:00,000 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 07:50:00,000 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 07:50:00,000 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 07:51:56,251 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 07:51:56,251 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 07:51:56,251 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 07:51:56,251 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 08:01:56,252 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 08:01:56,252 [INFO] Запуск player_passport_etl.py
2025-06-23 08:02:00,504 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 08:02:00,504 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 08:02:00,504 [INFO] Запуск player_h2h_etl.py
2025-06-23 08:02:07,919 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 08:02:07,919 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 08:02:07,919 [INFO] Запуск player_resilience_etl.py
2025-06-23 08:03:03,571 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 08:03:03,571 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 08:03:03,571 [INFO] Запуск player_style_etl.py
2025-06-23 08:03:38,219 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Эдуард Кабанов' 75.32203389830508]
 ['Алексей Бобряков' 75.25892857142857]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 08:03:38,219 [INFO] player_style_etl.py успешно выполнен
2025-06-23 08:03:38,219 [INFO] Запуск player_fatigue_etl.py
2025-06-23 08:03:46,990 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 08:03:46,990 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 08:03:46,990 [INFO] Запуск player_elo_etl.py
2025-06-23 08:04:12,703 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-23 08:04:12,704 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 08:04:12,704 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 08:05:35,820 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 08:05:35,820 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 08:05:35,821 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 08:05:38,289 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 08:05:38,289 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 08:05:38,289 [INFO] Запуск player_table_stats_etl.py
2025-06-23 08:05:44,710 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 08:05:44,711 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 08:05:44,711 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 08:07:30,749 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 08:07:30,749 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 08:07:30,749 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 08:07:30,749 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 08:17:30,750 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 08:17:30,750 [INFO] Запуск player_passport_etl.py
2025-06-23 08:17:31,591 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 08:17:31,591 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 08:17:31,591 [INFO] Запуск player_h2h_etl.py
2025-06-23 08:17:37,217 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 08:17:37,217 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 08:17:37,217 [INFO] Запуск player_resilience_etl.py
2025-06-23 08:18:43,263 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 08:18:43,263 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 08:18:43,264 [INFO] Запуск player_style_etl.py
2025-06-23 08:19:28,336 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Эдуард Кабанов' 75.32203389830508]
 ['Алексей Бобряков' 75.25892857142857]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 08:19:28,336 [INFO] player_style_etl.py успешно выполнен
2025-06-23 08:19:28,336 [INFO] Запуск player_fatigue_etl.py
2025-06-23 08:19:37,411 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 08:19:37,411 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 08:19:37,411 [INFO] Запуск player_elo_etl.py
2025-06-23 08:19:53,877 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125872 записей (по всем матчам)
2025-06-23 08:19:53,877 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 08:19:53,877 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 08:21:13,040 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
2025-06-23 08:21:13,040 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-23 08:21:13,040 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-23 08:21:13,040 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 08:21:22,022 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 08:21:22,022 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 08:21:22,022 [INFO] Запуск player_table_stats_etl.py
2025-06-23 08:21:26,585 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 08:21:26,586 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 08:21:26,586 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 08:23:18,111 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 08:23:18,111 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 08:23:18,111 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 08:23:18,111 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 08:33:18,112 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 08:33:18,112 [INFO] Запуск player_passport_etl.py
2025-06-23 08:33:18,444 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 08:33:18,444 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 08:33:18,444 [INFO] Запуск player_h2h_etl.py
2025-06-23 08:33:22,620 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 08:33:22,621 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 08:33:22,621 [INFO] Запуск player_resilience_etl.py
2025-06-23 08:34:16,263 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 08:34:16,263 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 08:34:16,263 [INFO] Запуск player_style_etl.py
2025-06-23 08:34:59,683 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Эдуард Кабанов' 75.32203389830508]
 ['Алексей Бобряков' 75.25892857142857]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 08:34:59,683 [INFO] player_style_etl.py успешно выполнен
2025-06-23 08:34:59,683 [INFO] Запуск player_fatigue_etl.py
2025-06-23 08:35:10,950 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 08:35:10,950 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 08:35:10,950 [INFO] Запуск player_elo_etl.py
2025-06-23 08:35:37,855 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 08:35:37,855 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-23 08:35:37,856 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 08:35:37,856 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 08:36:49,390 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 08:36:49,390 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 08:36:49,390 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 08:36:51,113 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 08:36:51,113 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 08:36:51,113 [INFO] Запуск player_table_stats_etl.py
2025-06-23 08:36:55,064 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 08:36:55,065 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 08:36:55,065 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 08:38:59,930 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
2025-06-23 08:38:59,930 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_sos_windows_etl.py", line 86, in <module>
    df_sos.to_sql('player_sos_windows', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_sos_windows"': database is locked
2025-06-23 08:38:59,930 [ERROR] player_sos_windows_etl.py завершился с кодом 1
2025-06-23 08:38:59,931 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 08:38:59,931 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 08:48:59,931 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 08:48:59,931 [INFO] Запуск player_passport_etl.py
2025-06-23 08:49:01,526 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 08:49:01,526 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 08:49:01,526 [INFO] Запуск player_h2h_etl.py
2025-06-23 08:49:06,863 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 08:49:06,863 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 08:49:06,864 [INFO] Запуск player_resilience_etl.py
2025-06-23 08:49:56,289 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 08:49:56,289 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 08:49:56,289 [INFO] Запуск player_style_etl.py
2025-06-23 08:50:29,827 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Эдуард Кабанов' 75.32203389830508]
 ['Алексей Бобряков' 75.25892857142857]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 08:50:29,827 [INFO] player_style_etl.py успешно выполнен
2025-06-23 08:50:29,828 [INFO] Запуск player_fatigue_etl.py
2025-06-23 08:50:47,863 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 08:50:47,863 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 08:50:47,863 [INFO] Запуск player_elo_etl.py
2025-06-23 08:51:16,644 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125882 записей (по всем матчам)
2025-06-23 08:51:16,644 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 08:51:16,644 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 08:52:44,591 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 08:52:44,591 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 08:52:44,591 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 08:52:46,765 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 08:52:46,765 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 08:52:46,765 [INFO] Запуск player_table_stats_etl.py
2025-06-23 08:52:50,906 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 08:52:50,907 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 08:52:50,907 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 08:54:34,643 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 08:54:34,644 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 08:54:34,644 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 08:54:34,644 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 09:04:34,644 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 09:04:34,644 [INFO] Запуск player_passport_etl.py
2025-06-23 09:04:36,236 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 09:04:36,236 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 09:04:36,236 [INFO] Запуск player_h2h_etl.py
2025-06-23 09:04:41,528 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 09:04:41,528 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 09:04:41,528 [INFO] Запуск player_resilience_etl.py
2025-06-23 09:05:44,038 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 09:05:44,039 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 09:05:44,039 [INFO] Запуск player_style_etl.py
2025-06-23 09:06:22,616 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Эдуард Кабанов' 75.32203389830508]
 ['Алексей Бобряков' 75.25892857142857]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 09:06:22,616 [INFO] player_style_etl.py успешно выполнен
2025-06-23 09:06:22,616 [INFO] Запуск player_fatigue_etl.py
2025-06-23 09:06:31,375 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 09:06:31,375 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 09:06:31,375 [INFO] Запуск player_elo_etl.py
2025-06-23 09:06:48,028 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125886 записей (по всем матчам)
2025-06-23 09:06:48,029 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 09:06:48,029 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 09:08:09,684 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 09:08:09,685 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 09:08:09,685 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 09:08:11,773 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 09:08:11,773 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 09:08:11,773 [INFO] Запуск player_table_stats_etl.py
2025-06-23 09:08:16,108 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 09:08:16,108 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 09:08:16,108 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 09:10:04,467 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 09:10:04,467 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 09:10:04,467 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 09:10:04,467 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 09:20:04,468 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 09:20:04,468 [INFO] Запуск player_passport_etl.py
2025-06-23 09:20:05,890 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 09:20:05,890 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 09:20:05,890 [INFO] Запуск player_h2h_etl.py
2025-06-23 09:20:10,007 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 09:20:10,007 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 09:20:10,007 [INFO] Запуск player_resilience_etl.py
2025-06-23 09:21:10,772 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 09:21:10,772 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 09:21:10,772 [INFO] Запуск player_style_etl.py
2025-06-23 09:22:06,133 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 09:22:06,133 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 09:22:06,133 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 09:22:06,133 [INFO] Запуск player_fatigue_etl.py
2025-06-23 09:22:20,054 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 09:22:20,054 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 09:22:20,054 [INFO] Запуск player_elo_etl.py
2025-06-23 09:22:45,897 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125888 записей (по всем матчам)
2025-06-23 09:22:45,897 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 09:22:45,897 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 09:23:50,995 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 09:23:50,995 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 09:23:50,995 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 09:23:58,276 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 09:23:58,276 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 09:23:58,276 [INFO] Запуск player_table_stats_etl.py
2025-06-23 09:24:02,756 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 09:24:02,756 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 09:24:02,756 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 09:26:06,840 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 09:26:06,840 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 09:26:06,840 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 09:26:06,840 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 09:36:06,840 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 09:36:06,841 [INFO] Запуск player_passport_etl.py
2025-06-23 09:36:07,174 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 09:36:07,174 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 09:36:07,175 [INFO] Запуск player_h2h_etl.py
2025-06-23 09:36:11,388 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 09:36:11,389 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 09:36:11,389 [INFO] Запуск player_resilience_etl.py
2025-06-23 09:36:57,592 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 09:36:57,592 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 09:36:57,592 [INFO] Запуск player_style_etl.py
2025-06-23 09:37:39,083 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 09:37:39,084 [INFO] player_style_etl.py успешно выполнен
2025-06-23 09:37:39,084 [INFO] Запуск player_fatigue_etl.py
2025-06-23 09:37:55,365 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 09:37:55,365 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 09:37:55,365 [INFO] Запуск player_elo_etl.py
2025-06-23 09:38:20,431 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125892 записей (по всем матчам)
2025-06-23 09:38:20,431 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 09:38:20,431 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 09:39:37,635 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 09:39:37,636 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 09:39:37,636 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 09:39:39,373 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 09:39:39,373 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 09:39:39,373 [INFO] Запуск player_table_stats_etl.py
2025-06-23 09:39:43,327 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 09:39:43,327 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 09:39:43,327 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 09:41:35,253 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 09:41:35,253 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 09:41:35,253 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 09:41:35,254 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 09:51:35,254 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 09:51:35,254 [INFO] Запуск player_passport_etl.py
2025-06-23 09:51:42,415 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 09:51:42,415 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 09:51:42,415 [INFO] Запуск player_h2h_etl.py
2025-06-23 09:51:48,028 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 09:51:48,028 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 09:51:48,028 [INFO] Запуск player_resilience_etl.py
2025-06-23 09:52:46,337 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 09:52:46,337 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 09:52:46,337 [INFO] Запуск player_style_etl.py
2025-06-23 09:53:18,696 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 09:53:18,696 [INFO] player_style_etl.py успешно выполнен
2025-06-23 09:53:18,696 [INFO] Запуск player_fatigue_etl.py
2025-06-23 09:53:27,459 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 09:53:27,459 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 09:53:27,460 [INFO] Запуск player_elo_etl.py
2025-06-23 09:53:43,855 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125896 записей (по всем матчам)
2025-06-23 09:53:43,856 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 09:53:43,856 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 09:55:08,569 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 09:55:08,569 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 09:55:08,569 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 09:55:11,854 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 09:55:11,855 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 09:55:11,855 [INFO] Запуск player_table_stats_etl.py
2025-06-23 09:55:18,589 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 09:55:18,589 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 09:55:18,589 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 09:57:00,778 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 09:57:00,778 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 09:57:00,779 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 09:57:00,779 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 10:07:00,779 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 10:07:00,779 [INFO] Запуск player_passport_etl.py
2025-06-23 10:07:01,469 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 10:07:01,469 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 10:07:01,469 [INFO] Запуск player_h2h_etl.py
2025-06-23 10:07:14,003 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 10:07:14,004 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 10:07:14,004 [INFO] Запуск player_resilience_etl.py
2025-06-23 10:08:17,662 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 10:08:17,663 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 10:08:17,663 [INFO] Запуск player_style_etl.py
2025-06-23 10:09:07,753 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
2025-06-23 10:09:07,754 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_style_etl.py", line 109, in <module>
    df_style.to_sql('player_style', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_style"': database is locked
2025-06-23 10:09:07,754 [ERROR] player_style_etl.py завершился с кодом 1
2025-06-23 10:09:07,754 [INFO] Запуск player_fatigue_etl.py
2025-06-23 10:09:21,868 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 10:09:21,868 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 10:09:21,869 [INFO] Запуск player_elo_etl.py
2025-06-23 10:09:38,985 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125902 записей (по всем матчам)
2025-06-23 10:09:38,986 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 10:09:38,986 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 10:10:46,103 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 10:10:46,103 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 10:10:46,103 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 10:10:48,705 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 10:10:48,705 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 10:10:48,705 [INFO] Запуск player_table_stats_etl.py
2025-06-23 10:10:55,590 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 10:10:55,590 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 10:10:55,590 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 10:12:54,536 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 10:12:54,536 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 10:12:54,536 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 10:12:54,536 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 10:22:54,536 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 10:22:54,537 [INFO] Запуск player_passport_etl.py
2025-06-23 10:22:54,880 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 10:22:54,880 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 10:22:54,880 [INFO] Запуск player_h2h_etl.py
2025-06-23 10:22:59,204 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 10:22:59,204 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 10:22:59,204 [INFO] Запуск player_resilience_etl.py
2025-06-23 10:23:45,541 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 10:23:45,541 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 10:23:45,541 [INFO] Запуск player_style_etl.py
2025-06-23 10:24:31,497 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Вадим Баталов' 69.37096774193549]]
Таблица player_style обновлена: 369 игроков
2025-06-23 10:24:31,497 [INFO] player_style_etl.py успешно выполнен
2025-06-23 10:24:31,497 [INFO] Запуск player_fatigue_etl.py
2025-06-23 10:24:42,850 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 10:24:42,851 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 10:24:42,851 [INFO] Запуск player_elo_etl.py
2025-06-23 10:25:22,120 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 10:25:22,120 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 10:25:22,120 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 10:25:22,120 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 10:26:34,277 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 10:26:34,277 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 10:26:34,277 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 10:26:36,028 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 10:26:36,028 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 10:26:36,028 [INFO] Запуск player_table_stats_etl.py
2025-06-23 10:26:40,110 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 10:26:40,110 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 10:26:40,110 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 10:28:33,248 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 10:28:33,249 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 10:28:33,249 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 10:28:33,249 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 10:38:33,249 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 10:38:33,250 [INFO] Запуск player_passport_etl.py
2025-06-23 10:38:35,409 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 10:38:35,409 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 10:38:35,409 [INFO] Запуск player_h2h_etl.py
2025-06-23 10:38:41,483 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 10:38:41,483 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 10:38:41,484 [INFO] Запуск player_resilience_etl.py
2025-06-23 10:39:39,459 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 10:39:39,459 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 10:39:39,459 [INFO] Запуск player_style_etl.py
2025-06-23 10:40:13,906 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 69.11650485436893]]
Таблица player_style обновлена: 369 игроков
2025-06-23 10:40:13,906 [INFO] player_style_etl.py успешно выполнен
2025-06-23 10:40:13,907 [INFO] Запуск player_fatigue_etl.py
2025-06-23 10:40:23,844 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 10:40:23,845 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 10:40:23,845 [INFO] Запуск player_elo_etl.py
2025-06-23 10:40:51,730 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 10:40:51,730 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo_history"': database is locked
2025-06-23 10:40:51,730 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 10:40:51,730 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 10:42:25,399 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
2025-06-23 10:42:25,399 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-23 10:42:25,400 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-23 10:42:25,400 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 10:42:34,213 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 10:42:34,213 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 10:42:34,214 [INFO] Запуск player_table_stats_etl.py
2025-06-23 10:42:38,727 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 10:42:38,727 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 10:42:38,727 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 10:44:25,649 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 10:44:25,649 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 10:44:25,650 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 10:44:25,650 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 10:54:25,650 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 10:54:25,650 [INFO] Запуск player_passport_etl.py
2025-06-23 10:54:33,460 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-23 10:54:33,460 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-23 10:54:33,460 [INFO] Запуск player_h2h_etl.py
2025-06-23 10:54:46,664 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 10:54:46,664 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 10:54:46,664 [INFO] Запуск player_resilience_etl.py
2025-06-23 10:55:50,902 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 10:55:50,902 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 10:55:50,902 [INFO] Запуск player_style_etl.py
2025-06-23 10:56:30,122 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 69.1747572815534]]
Таблица player_style обновлена: 369 игроков
2025-06-23 10:56:30,122 [INFO] player_style_etl.py успешно выполнен
2025-06-23 10:56:30,122 [INFO] Запуск player_fatigue_etl.py
2025-06-23 10:56:39,288 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 10:56:39,288 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 10:56:39,289 [INFO] Запуск player_elo_etl.py
2025-06-23 10:56:56,712 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125912 записей (по всем матчам)
2025-06-23 10:56:56,712 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 10:56:56,712 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 10:58:19,597 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  live_market_odds: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  live_history: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 10:58:19,597 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 10:58:19,597 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 10:58:23,953 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 10:58:23,953 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 10:58:23,953 [INFO] Запуск player_table_stats_etl.py
2025-06-23 10:58:35,621 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 10:58:35,621 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 10:58:35,621 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 11:00:25,101 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 11:00:25,101 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 11:00:25,101 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 11:00:25,101 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 11:10:25,102 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 11:10:25,102 [INFO] Запуск player_passport_etl.py
2025-06-23 11:10:25,470 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 11:10:25,470 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 11:10:25,470 [INFO] Запуск player_h2h_etl.py
2025-06-23 11:10:30,839 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 11:10:30,839 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 11:10:30,839 [INFO] Запуск player_resilience_etl.py
2025-06-23 11:11:27,875 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 11:11:27,876 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 11:11:27,876 [INFO] Запуск player_style_etl.py
2025-06-23 11:12:03,191 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 68.625]]
Таблица player_style обновлена: 369 игроков
2025-06-23 11:12:03,192 [INFO] player_style_etl.py успешно выполнен
2025-06-23 11:12:03,192 [INFO] Запуск player_fatigue_etl.py
2025-06-23 11:12:20,709 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_fatigue_etl.py", line 110, in <module>
    fatigue_df.to_sql('player_fatigue', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_fatigue"': database is locked
2025-06-23 11:12:20,709 [ERROR] player_fatigue_etl.py завершился с кодом 1
2025-06-23 11:12:20,709 [INFO] Запуск player_elo_etl.py
2025-06-23 11:12:52,089 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125916 записей (по всем матчам)
2025-06-23 11:12:52,089 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 11:12:52,089 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 11:13:50,697 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  live_market_odds: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  live_history: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 11:13:50,697 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 11:13:50,697 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 11:13:52,531 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 11:13:52,532 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 11:13:52,532 [INFO] Запуск player_table_stats_etl.py
2025-06-23 11:14:04,101 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_table_stats_etl.py", line 108, in <module>
    result_df.to_sql('player_table_stats', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_table_stats"': database is locked
2025-06-23 11:14:04,101 [ERROR] player_table_stats_etl.py завершился с кодом 1
2025-06-23 11:14:04,101 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 11:15:39,890 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 11:15:39,890 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 11:15:39,890 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 11:15:39,890 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 11:25:39,891 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 11:25:39,891 [INFO] Запуск player_passport_etl.py
2025-06-23 11:25:40,232 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 11:25:40,232 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 11:25:40,232 [INFO] Запуск player_h2h_etl.py
2025-06-23 11:25:44,492 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 11:25:44,492 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 11:25:44,492 [INFO] Запуск player_resilience_etl.py
2025-06-23 11:26:37,539 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_resilience_etl.py", line 136, in <module>
    df.to_sql('player_resilience', conn, if_exists='replace', index=False)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_resilience"': database is locked
2025-06-23 11:26:37,539 [ERROR] player_resilience_etl.py завершился с кодом 1
2025-06-23 11:26:37,539 [INFO] Запуск player_style_etl.py
2025-06-23 11:27:11,663 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 68.74038461538461]]
Таблица player_style обновлена: 369 игроков
2025-06-23 11:27:11,663 [INFO] player_style_etl.py успешно выполнен
2025-06-23 11:27:11,664 [INFO] Запуск player_fatigue_etl.py
2025-06-23 11:27:22,010 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 11:27:22,010 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 11:27:22,010 [INFO] Запуск player_elo_etl.py
2025-06-23 11:27:47,339 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
2025-06-23 11:27:47,339 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 158, in <module>
    df_hist.to_sql('player_elo_history', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2841, in to_sql
    return table.insert(chunksize, method)
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 1121, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2537, in _execute_insert
    conn.executemany(self.insert_statement(num_rows=1), data_list)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database is locked
2025-06-23 11:27:47,339 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 11:27:47,339 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 11:28:49,850 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  live_market_odds: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  live_history: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 11:28:49,850 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 11:28:49,850 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 11:28:51,596 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 11:28:51,597 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 11:28:51,597 [INFO] Запуск player_table_stats_etl.py
2025-06-23 11:28:55,622 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 11:28:55,622 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 11:28:55,622 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 11:30:27,230 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 11:30:27,230 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 11:30:27,230 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 11:30:27,230 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 11:40:27,231 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 11:40:27,231 [INFO] Запуск player_passport_etl.py
2025-06-23 11:40:34,712 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl.py", line 46, in <module>
    passport.to_sql('player_passport', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passport"': database is locked
2025-06-23 11:40:34,712 [ERROR] player_passport_etl.py завершился с кодом 1
2025-06-23 11:40:34,713 [INFO] Запуск player_h2h_etl.py
2025-06-23 11:40:46,948 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_h2h_etl.py", line 78, in <module>
    df_h2h.to_sql('player_h2h', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_h2h"': database is locked
2025-06-23 11:40:46,948 [ERROR] player_h2h_etl.py завершился с кодом 1
2025-06-23 11:40:46,948 [INFO] Запуск player_resilience_etl.py
2025-06-23 11:41:31,072 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 11:41:31,073 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 11:41:31,073 [INFO] Запуск player_style_etl.py
2025-06-23 11:42:04,302 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 68.74038461538461]]
Таблица player_style обновлена: 369 игроков
2025-06-23 11:42:04,302 [INFO] player_style_etl.py успешно выполнен
2025-06-23 11:42:04,302 [INFO] Запуск player_fatigue_etl.py
2025-06-23 11:42:15,303 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 11:42:15,304 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 11:42:15,304 [INFO] Запуск player_elo_etl.py
2025-06-23 11:42:39,823 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_elo_etl.py", line 153, in <module>
    df_elo.to_sql('player_elo', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_elo"': database is locked
2025-06-23 11:42:39,823 [ERROR] player_elo_etl.py завершился с кодом 1
2025-06-23 11:42:39,824 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 11:43:55,637 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  live_market_odds: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  live_history: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
Готово: 376 паспортов обновлено. Файл БД: betcity_results.db
2025-06-23 11:43:55,637 [INFO] player_passport_etl_final_match_results_fix.py успешно выполнен
2025-06-23 11:43:55,637 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 11:44:03,197 [INFO] [STDOUT] Таблица league_reference_by_time обновлена! (all value-метрики по results)
2025-06-23 11:44:03,197 [INFO] league_reference_etl_ultimate.py успешно выполнен
2025-06-23 11:44:03,198 [INFO] Запуск player_table_stats_etl.py
2025-06-23 11:44:07,684 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 11:44:07,684 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 11:44:07,684 [INFO] Запуск player_sos_windows_etl.py
2025-06-23 11:45:51,327 [INFO] [STDOUT] glicko2_snapshot не найден — используем elo_final как proxy.
Таблица player_sos_windows обновлена: 377 игроков
2025-06-23 11:45:51,327 [INFO] player_sos_windows_etl.py успешно выполнен
2025-06-23 11:45:51,327 [INFO] === Пакетный запуск ETL завершён ===
2025-06-23 11:45:51,327 [INFO] Ждём 10 минут до следующего запуска...
2025-06-23 11:55:51,328 [INFO] === Начало пакетного запуска ETL ===
2025-06-23 11:55:51,328 [INFO] Запуск player_passport_etl.py
2025-06-23 11:55:54,128 [INFO] [STDOUT] Паспорт игроков собран: 377 строк. Таблица player_passport обновлена!
2025-06-23 11:55:54,128 [INFO] player_passport_etl.py успешно выполнен
2025-06-23 11:55:54,129 [INFO] Запуск player_h2h_etl.py
2025-06-23 11:56:00,455 [INFO] [STDOUT] Таблица player_h2h обновлена: 374 игроков
2025-06-23 11:56:00,455 [INFO] player_h2h_etl.py успешно выполнен
2025-06-23 11:56:00,455 [INFO] Запуск player_resilience_etl.py
2025-06-23 11:57:00,004 [INFO] [STDOUT] Таблица player_resilience обновлена: 369 игроков
2025-06-23 11:57:00,004 [INFO] player_resilience_etl.py успешно выполнен
2025-06-23 11:57:00,004 [INFO] Запуск player_style_etl.py
2025-06-23 11:57:36,344 [INFO] [STDOUT] Топ-3 aggressive:  [['Николай Ижиков' 82.28571428571429]
 ['Эдуард Головачев' 80.66477272727273]
 ['Артем Чернов' 79.60227272727273]]
Топ-3 balanced:  [['Антон Боев' 75.50847457627118]
 ['Алексей Бобряков' 75.25892857142857]
 ['Алексей Конобеев' 75.22]]
Топ-3 chaotic:  [['Богдан Гребенюк' 76.30147058823529]
 ['Сергей Лановенко' 76.28686868686869]
 ['Степан Кутепов' 75.47241379310344]]
Топ-3 defensive:  [['Василий Югов' 67.5]
 ['Дмитрий Козубенко' 67.76470588235294]
 ['Сергей Ивашечкин' 68.74038461538461]]
Таблица player_style обновлена: 369 игроков
2025-06-23 11:57:36,344 [INFO] player_style_etl.py успешно выполнен
2025-06-23 11:57:36,344 [INFO] Запуск player_fatigue_etl.py
2025-06-23 11:57:46,655 [INFO] [STDOUT] Таблица player_fatigue обновлена: 376 игроков
2025-06-23 11:57:46,655 [INFO] player_fatigue_etl.py успешно выполнен
2025-06-23 11:57:46,655 [INFO] Запуск player_elo_etl.py
2025-06-23 11:58:04,347 [INFO] [STDOUT] Таблица player_elo обновлена: 377 игроков
Таблица player_elo_history обновлена: 125928 записей (по всем матчам)
2025-06-23 11:58:04,347 [INFO] player_elo_etl.py успешно выполнен
2025-06-23 11:58:04,347 [INFO] Запуск player_passport_etl_final_match_results_fix.py
2025-06-23 11:59:30,882 [INFO] [STDOUT] В базе найдены таблицы и столбцы:
  results: ['match_id', 'table_label', 'player1', 'player2', 'sc_ev', 'sc_ext_ev', 'finished']
  match_results: ['match_id', 'finished_ts', 'p1_sets', 'p2_sets', 'winner_id', 'loser_id', 'duration_sec', 'match_intensity', 'progress', 'comeback', 'created_at', 'updated_at']
  set_scores: ['match_id', 'set_no', 'p1_pts', 'p2_pts']
  line_matches: ['match_id', 'tournament', 'table_id', 'start_ts', 'is_live', 'status', 'updated_at']
  line_markets: ['match_id', 'market_id', 'line_value', 'coeff_json', 'updated_at']
  line_market_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  results_odds: ['match_id', 'market_id', 'line_value', 'side', 'kf']
  line_markets_history: ['match_id', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum', 'updated_at']
  live_market_odds: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  live_history: ['match_id', 'updated_at', 'market_id', 'line_value', 'side', 'kf', 'marg', 'maximum']
  player_passports: ['player_name', 'matches_played', 'win_pct_all', 'win_pct_20', 'avg_set_margin', 'set_margin_sd', 'ov70_5_hit_pct', 'ov72_5_hit_pct', 'ov74_5_hit_pct', 'ov75_5_hit_pct', 'ov78_5_hit_pct', 'ov80_5_hit_pct', 'cover_set_m1_5_pct', 'cover_set_p1_5_pct', 'cover_pt_m3_5_pct', 'cover_pt_p3_5_pct', 'avg_match_duration_sec', 'pct_matches_gt18min', 'avg_rest_hours', 'pct_rest_lt8h']
  league_reference_by_time: ['window', 'slot', 'n_matches', 'mean_tot_points', 'median_tot_points', 'min_tot_points', 'max_tot_points', 'dry_win_mu', 'score_3_2_mu', 'score_3_1_mu', 'score_3_0_mu', 'come_from_behind_mu', 'pts_diff_lt8', 'pts_diff_lt12', 'ov65_5_mu', 'ov70_5_mu', 'ov74_5_mu', 'ov75_5_mu', 'ov76_5_mu', 'ov78_5_mu', 'ov80_5_mu', 'ov85_5_mu']
  player_table_stats: ['player', 'table_label', 'matches_played', 'win_pct', 'ov74_5_hit_pct', 'avg_pts_match_diff', 'variance_factor', 'edge_flag_table', 'cf_flag']
  player_sos_windows: ['player_name', 'sos_last_5m', 'sos_last_5m_cf', 'sos_last_10m', 'sos_last_10m_cf', 'sos_last_30m', 'sos_last_30m_cf', 'sos_last_2d', 'sos_last_2d_cf', 'sos_last_7d', 'sos_last_7d_cf', 'sos_last_30d', 'sos_last_30d_cf']
  player_passport: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty', 'matches_played_x', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all', 'matches_played_y', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_h2h: ['player_name', 'h2h_vs_aggressive_winrate', 'h2h_vs_defensive_winrate', 'h2h_vs_balanced_winrate', 'h2h_vs_chaotic_winrate']
  player_resilience: ['player_name', 'matches_played', 'comeback_1set_win', 'comeback_0_2_win', 'surrender_0_2_lose', 'clutch_win', 'dry_win', 'volatility_pts', 'volatility_sets', 'median_lose_margin', 'comeback_streak_avg']
  player_style: ['player_name', 'matches_played', 'avg_total_pts', 'avg_duration_sec', 'avg_pt_margin', 'avg_set_margin', 'style']
  player_fatigue: ['player_name', 'matches_played', 'avg_rest_hours', 'pct_rest_lt4h', 'pct_rest_lt8h', 'pct_back_to_back_days', 'pct_night_matches', 'winrate_night', 'winrate_all']
  player_elo: ['player_name', 'elo_final', 'total_matches', 'last_match_ts', 'total_decay_penalty']
  player_elo_history: ['player', 'match_id', 'elo_before', 'elo_after', 'opponent', 'date', 'result', 'k', 'decay_penalty']
2025-06-23 11:59:30,882 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\player_passport_etl_final_match_results_fix.py", line 178, in <module>
    df_pass.to_sql('player_passports', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "player_passports"': database is locked
2025-06-23 11:59:30,883 [ERROR] player_passport_etl_final_match_results_fix.py завершился с кодом 1
2025-06-23 11:59:30,883 [INFO] Запуск league_reference_etl_ultimate.py
2025-06-23 11:59:39,936 [ERROR] [STDERR] Traceback (most recent call last):
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2664, in execute
    cur.execute(sql, *args)
    ~~~~~~~~~~~^^^^^^^^^^^^
sqlite3.OperationalError: database is locked

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\kirka\Downloads\результаты со скользящим окном\league_reference_etl_ultimate.py", line 150, in <module>
    league_df.to_sql('league_reference_by_time', conn, if_exists='replace', index=False)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Python38\Lib\site-packages\pandas\core\generic.py", line 3106, in to_sql
    return sql.to_sql(
           ~~~~~~~~~~^
        self,
        ^^^^^
    ...<8 lines>...
        method=method,
        ^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 844, in to_sql
    return pandas_sql.to_sql(
           ~~~~~~~~~~~~~~~~~^
        frame,
        ^^^^^^
    ...<9 lines>...
        **engine_kwargs,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2840, in to_sql
    table.create()
    ~~~~~~~~~~~~^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 990, in create
    self.pd_sql.drop_table(self.name, self.schema)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2862, in drop_table
    self.execute(drop_sql)
    ~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Python38\Lib\site-packages\pandas\io\sql.py", line 2676, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'DROP TABLE "league_reference_by_time"': database is locked
2025-06-23 11:59:39,936 [ERROR] league_reference_etl_ultimate.py завершился с кодом 1
2025-06-23 11:59:39,936 [INFO] Запуск player_table_stats_etl.py
2025-06-23 11:59:50,029 [INFO] [STDOUT] player_table_stats обновлён! Только значения с min_sample (A9:10, остальные 20) edge-флагируются.
2025-06-23 11:59:50,029 [INFO] player_table_stats_etl.py успешно выполнен
2025-06-23 11:59:50,029 [INFO] Запуск player_sos_windows_etl.py
